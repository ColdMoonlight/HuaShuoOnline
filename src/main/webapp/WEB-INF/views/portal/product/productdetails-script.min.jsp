<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<% pageContext.setAttribute("APP_PATH", request.getContextPath()); %>
<script>function addHeaderInfo(t){var o=t.productName,e=t.productMetaDesc,r=t.productSeo,p="https://www.megalook.com/"+r+".html",c=t.productMainimgurl,n=accuracyCal(t.productOriginalprice,t.productActoffoff),a=t.productId,d=$('<meta property = "og:title" content ="'+o+'"><meta property = "og:description" content = "'+e+'" ><meta property = "og:url" content = "'+p+'" ><meta property = "og:image" content = "'+c+'" ><meta property = "product:brand" content = "MegaLook" ><meta property = "product:availability" content = "in stock" ><meta property = "product:condition" content = "new" > <meta property = "product:price:amount" content = "'+n+'" ><meta property = "product:price:currency" content = "USD" ><meta property = "product:retailer_item_id" content = "'+a+'" >');$(document.head).append(d)}</script>
<script>!function(a){a.fly=function(b,c){var d={version:"1.0.1",autoPlay:!0,vertex_Rtop:20,speed:1.2,start:{},end:{},onEnd:a.noop},e=this,f=a(b);e.init=function(a){this.setOptions(a),!!this.settings.autoPlay&&this.play()},e.setOptions=function(b){this.settings=a.extend(!0,{},d,b);var c=this.settings,e=c.start,g=c.end;f.css({marginTop:"0px",marginLeft:"0px",position:"fixed"}).appendTo("body"),null!=g.width&&null!=g.height&&a.extend(!0,e,{width:f.width(),height:f.height()});var h=Math.min(e.top,g.top)-Math.abs(e.left-g.left)/3;h<c.vertex_Rtop&&(h=Math.min(c.vertex_Rtop,Math.min(e.top,g.top)));var i=Math.sqrt(Math.pow(e.top-g.top,2)+Math.pow(e.left-g.left,2)),j=Math.ceil(Math.min(Math.max(Math.log(i)/.05-75,30),100)/c.speed),k=e.top==h?0:-Math.sqrt((g.top-h)/(e.top-h)),l=(k*e.left-g.left)/(k-1),m=g.left==l?0:(g.top-h)/Math.pow(g.left-l,2);a.extend(!0,c,{count:-1,steps:j,vertex_left:l,vertex_top:h,curvature:m})},e.play=function(){this.move()},e.move=function(){var b=this.settings,c=b.start,d=b.count,e=b.steps,g=b.end,h=c.left+(g.left-c.left)*d/e,i=0==b.curvature?c.top+(g.top-c.top)*d/e:b.curvature*Math.pow(h-b.vertex_left,2)+b.vertex_top;if(null!=g.width&&null!=g.height){var j=e/2,k=g.width-(g.width-c.width)*Math.cos(j>d?0:(d-j)/(e-j)*Math.PI/2),l=g.height-(g.height-c.height)*Math.cos(j>d?0:(d-j)/(e-j)*Math.PI/2);f.css({width:k+"px",height:l+"px","font-size":Math.min(k,l)+"px"})}f.css({left:h+"px",top:i+"px"}),b.count++;var m=window.requestAnimationFrame(a.proxy(this.move,this));d==e&&(window.cancelAnimationFrame(m),b.onEnd.apply(this))},e.destroy=function(){f.remove()},e.init(c)},a.fn.fly=function(b){return this.each(function(){void 0==a(this).data("fly")&&a(this).data("fly",new a.fly(this,b))})}}(jQuery);</script>
<script>function generateFlyBubble(e,t){$('<img class="ml-flyer" src="'+mainUrl+'" />').fly({start:{left:e.pageX-window.pageXOffset,top:e.pageY-window.pageYOffset},end:{left:window.innerWidth-30,top:150,width:0,height:0},onEnd:function(){this.destroy(),t()}})}function updateProductData(e){var t=mapSet[e.join(",")],i=mapItems[e.join(",")]||{};if(Object.keys(mapSet).length&&Object.keys(mapItems).length){$(".product-qty .product-num").data("count",t.count).data("productsku",i);var r=i.productskuMoney;r?updateProductPrice(r):updateProductPrice()}else mlModalTip("I'm sorry that the product cannot be purchased for the time being. If necessary, please contact customer service !")}function updateProductPrice(t){function c(t){return t&&parseFloat(t)?parseFloat(t):0}var e=$(".product-details").data("product"),r=e.productPrice+c(t),o=accuracyCal(r,e.productDiscount);100==e.productDiscount?$(".product-single-price").text("$"+r.toFixed(2)):($(".product-define-price").text("$"+r.toFixed(2)),$(".product-now-price").text("$"+o),$(".product-price-save").text("save $"+(r-parseFloat(o)).toFixed(2)))}function getProductData(){function e(e){var t="";return $(".product-slide .swiper-slide").each(function(i,r){$(r).data("sku")&&$(r).data("sku")==e&&(t=$(r).find(".img").data("src"))}),t}var t={},i=$(".product-details").data("product")||{},r=$(".product-qty .product-num").data("productsku");return!(!r||!Object.keys(r).length)&&(t.cartitemProductId=i.proudctId,t.cartitemProductSeoName=i.productSeo,t.cartitemProductName=i.productName,t.cartitemProductOriginalprice=i.productPrice,t.cartitemProductMainimgurl=e(r.productskuName)||i.productMainImgUrl,t.cartitemProductActoff=i.productDiscount,t.cartitemProductskuIdstr=optionIdArr.join(","),t.cartitemProductskuIdnamestr=Object.keys(optionObj).join(","),t.cartitemProductskuId=r.productskuId,t.cartitemProductskuName=r.productskuName,t.cartitemProductskuCode=r.productskuCode,t.cartitemProductskuMoneystr=r.productskuMoney,t.cartitemProductNumber=parseInt($(".product-qty .product-num").val()),t)}function addToCart(e,t){$.ajax({url:"${APP_PATH}/MlbackCart/toAddToCart",data:JSON.stringify(e),type:"post",dataType:"json",contentType:"application/json",success:function(e){100==e.code?t&&t():mlModalTip("Failed to add products to cart !</p>")},error:function(e){sysModalTip()}})}function toBuyNow(e,t){$.ajax({url:"${APP_PATH}/MlbackCart/toBuyNow",data:JSON.stringify(e),type:"post",dataType:"json",contentType:"application/json",success:function(e){100==e.code?t():mlModalTip("I'm sorry, temporarily unable to settlement, please try again later !")},error:function(e){sysModalTip()}})}function renderProductMedia(e){function t(){$("#ml-video")[0]&&$("#ml-video")[0].pause()}var i=$(".product-slide .swiper-wrapper").html(),r="",o="",a="";e.video&&(r='<div class="swiper-slide"><div class=" lazyload" data-src="'+e.video.posterUrl+'"></div></div>',o='<div class="swiper-slide"><video id="ml-video" controls preload="none" poster="'+e.video.posterUrl+'"><source src="'+e.video.videoUrl+'" type="video/mp4" /></video></div>'),e.skuImgs&&e.skuImgs.length&&e.skuImgs.forEach(function(e){a+='<div class="swiper-slide" data-sku="'+e.sku+'"><div class="lazyload img" data-src="'+e.url+'" rel="'+e.url+'"></div></div>'}),$(".product-thumb-slide .swiper-wrapper").html(r+i+a),$(".product-slide .swiper-wrapper").html(o+i+a),$("#ml-video").on("play",function(){pintrk("track","watchvideo")}),new LazyLoad($(".product-media .lazyload"),{root:null,rootMargin:"10px",threshold:0});var d=new Swiper(".product-thumb-slide",{slidesPerView:"auto",spaceBetween:5,freeMode:!0,watchSlidesVisibility:!0,watchSlidesProgress:!0,on:{slideChangeTransitionStart:function(){t()}}});new Swiper(".product-slide",{pagination:{el:".product-slide-box .swiper-pagination",clickable:!0},navigation:{nextEl:".product-slide-box .swiper-button-next",prevEl:".product-slide-box .swiper-button-prev"},on:{slideChangeTransitionStart:function(){t()}},thumbs:{swiper:d}});imageZoomEvent()}function renderProductDetails(e){$(".product-details").data("product",{proudctId:e.productId,productName:e.productName,productDiscount:e.productActoffoff,productMainImgUrl:e.productMainimgurl,productPrice:e.productOriginalprice,productSeo:e.productSeo}),$(".product-name").text(e.productName),$(".product-reviews").html('<div class="product-review-stars"><span class="icon avgstar2"></span><span class="icon avgstar"></span></div><a href="#product-reviews" class="product-media-review-num"></a>'),$(".product-sold-num").html("Sold: <b>"+e.productHavesalenum+"</b>"),$(".product-price").html('<div class="name">Total Price:</div>'+renderProductPriceHtml(e)),100==e.productActoffoff?$(".product-price-save").addClass("hide"):$(".product-price-save").html("save $"+(e.productOriginalprice-accuracyCal(e.productOriginalprice,e.productActoffoff)).toFixed(2)),$(".product-description").html(e.productDesc)}function createReviewSwiper(e,t){var i=e.reduce(function(e,t){return e+='<div class="swiper-slide"><img class="lazyload" src="'+t+'" /></div>',e},"");if(reviewSwiper)$(".review-swiper-box .swiper-wrapper").html(i),reviewSwiper.updateSlides(),reviewSwiper.slideTo(t,0,!1),$(".review-swiper-box").show(),addFixed();else{var r=$('<div class="review-swiper-box"><div id="review-swiper" class="swiper-container"><div class="swiper-wrapper">'+i+'</div><div class="swiper-pagination"></div><div class="swiper-button-next"></div><div class="swiper-button-prev"></div></div><div class="review-swiper-close"><span class="icon close"></span></div><div>');$(document.body).append(r),addFixed(),reviewSwiper=new Swiper("#review-swiper",{pagination:{el:".swiper-pagination",type:"fraction"},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}}),reviewSwiper.slideTo(t,0,!1)}}function getProductDetails(e){$.ajax({url:"${APP_PATH}/MlbackProduct/getOneMlbackProductDetail",data:JSON.stringify({productId:productId}),dataType:"json",contentType:"application/json",type:"post",async:!1,success:function(t){100==t.code&&e(t.extend.mlbackProductOne)}})}function selectCartOrCheckout(e){var t='<div class="cart-checkout-product"><div class="lazyload" data-src="'+e.cartitemProductMainimgurl+'"></div><div class="cart-checkout-data"><div class="cart-checkout-productname">'+e.cartitemProductName+'</div><div class="cart-checkout-productprice"><div class="name">Price: </div><div class="value">$'+accuracyCal(e.cartitemProductOriginalprice+parseFloat(e.cartitemProductskuMoneystr),e.cartitemProductActoff)+'</div></div><div class="btn-group"><a class="btn" href="javascript:goToCartList();">View Cart</a><a class="btn btn-pink buy-now">Checkout</a></div></div></div>',i=createModal({header:{html:"<p>Product successfully added to your cart!</p>"},body:{html:t},footer:{isShow:!0,html:"Free Gift For Every Order!"},autoClose:!1});new LazyLoad(i.find(".lazyload"),{root:null,rootMargin:"10px",threshold:0}),i.addClass("cart-checkout"),setTimeout(function(){removeModal(i)},5e3)}function getReviewCalData(e){$.ajax({url:"${APP_PATH}/MlfrontReview/getMlfrontReviewCount",data:JSON.stringify({reviewPid:productId}),type:"post",dataType:"json",contentType:"application/json",success:function(t){100==t.code?e&&e(t.extend):refreshPageModal()},error:function(e){refreshPageModal()}})}function getReviewListData(e){$.ajax({url:"${APP_PATH}/MlfrontReview/getMlfrontReviewByProductIdAndPage",data:JSON.stringify({reviewPid:productId,reviewUid:getPageNum(),searchType:e||""}),type:"post",dataType:"json",contentType:"application/json",success:function(e){if(100==e.code){var t=e.extend.pageInfo;t.list.length?(renderProductReviewList(t.list,e.extend.imgUrlStrListst),renderTablePagination(t)):($(".product-review-list").html('<p class="text-error">here are no comments yet, you can just click the <i>Write a Reveiw</i> button to write a comment !</p>'),$("#table-pagination").html(""))}else refreshPageModal()},error:function(e){refreshPageModal()}})}function renderProudctReviewCal(e){var t=e.allReviewNum,i=e.StartNumList,r=i?i.reduce(function(e,t){return e+=t.startCount*t.startNum,e},0):0,o=Math.ceil(r/t);htmlStr="";$('.product-media-review-num').html((e.allReviewNum || 0) + ' Review(s)');for(var a=4,d=0;a>=0;a-=1)d=e.allReviewNum?100*i[a].startCount/e.allReviewNum:0,4==a&&$(".product-review-stars .avgstar").css("width",d+"%"),htmlStr+='<div class="product-review-star-item"><div class="stars">'+(a+1)+' star</div><div class="progress"><div class="progress-inner" style="width: '+d+'%"></div></div><div class="data">'+d.toFixed(2)+"%</div></div>";$(".product-review-avgstar .icon").each(function(e,t){e<o&&$(t).removeClass(".star").addClass("star2")}),$(".product-review-star-list").html(htmlStr)}function renderProductReviewList(e,t){for(var i="",r=0,o=e.length;r<o;r++){i+='<div class="product-review-item"><div class="product-review-item-title"><div class="product-reivewer-img lazyload" data-src="'+e[r].reviewUimgurl+'"></div><div class="product-review-item-data"><div class="product-review-stars">';for(var a=0;a<5;a++)a<e[r].reviewProstarnum?i+='<span class="icon star2"></span>':i+='<span class="icon star"></span>';i+='</div><div class="product-review-author">'+e[r].reviewUname+'</div></div><div class="product-review-date">'+e[r].reviewCreatetime+'</div></div><div class="proudct-review-item-text">'+e[r].reviewDetailstr+'</div><div class="product-review-item-imgs">';for(var d=t[r].length<=6?t[r].length:6,c=0;c<d;c++)i+='<div class="product-review-imgs-item lazyload" data-src="'+t[r][c]+'"></div>';i+="</div></div>"}$(".product-review-list").html(i),new LazyLoad($(".product-review-list .lazyload"),{root:null,rootMargin:"10px",threshold:0})}function deleteReviewId(){reviewId&&$.ajax({url:"${APP_PATH }/MlfrontReview/delete",type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify({reviewId:reviewId}),success:function(e){}})}function getReviewId(){deleteReviewId(),$.ajax({url:"${APP_PATH }/MlfrontReview/initializaReview",type:"post",dataType:"json",contentType:"application/json",async:!1,success:function(e){100==e.code?reviewId=e.extend&&e.extend.mlfrontReview&&e.extend.mlfrontReview.reviewId:sysModalTip()},error:function(e){sysModalTip()}})}function saveReviewData(e,t){$.ajax({url:"${APP_PATH}/MlfrontReview/save",type:"post",data:JSON.stringify(e),dataType:"json",contentType:"application/json",async:!1,success:function(e){100==e.code?(mlModalTip("Successful operation. New comment information needs to be reviewed before it can be displayed !"),reviewId=null,t&&t()):mlModalTip("Operation Failed !")},error:function(){mlModalTip("Operation Failed !")}})}function resetProductStock(){var e=trimSpliter(getSelectedItem().join(","),","),t=mapSet[e].count;t>0?$(".product-stock").html("Only "+t+" pcs in stock, hurry!"):$(".product-stock").html("Sorry, it is sold out now.")}function imageZoomEvent(){window.innerWidth<1300?$(".product-slide.product-zoom").find(".img").off("mouseover"):$(".product-slide.product-zoom").find(".img").imagezoom()}(function(e){e.fn.imagezoom=function(t){function i(){e(document.body).unbind("mousemove"),e("div.zoomDiv").remove()}var r={xzoom:300,yzoom:300,scale:3};t&&e.extend(r,t),e(this).bind("mouseover",function(t){var o=e(this).offset().left,a=e(this).offset().top,d=e(this).get(0).offsetWidth,c=e(this).get(0).offsetHeight,n=e(this).parent().offset().left,s=e(this).parent().offset().top,u=e(this).parent().width(),l=e(this).parent().height(),p=e(this).attr("rel");0==e("div.zoomDiv").get().length&&e(document.body).append("<div class='zoomDiv'><img class='bigimg' src='"+p+"'/></div>"),e(this).css("cursor","crosshair"),e("div.zoomDiv").css({top:s,left:n+u}),e("div.zoomDiv").width(r.xzoom),e("div.zoomDiv").height(r.yzoom),e("div.zoomDiv .bigimg").width(r.xzoom*r.scale),e("div.zoomDiv .bigimg").height(r.yzoom*r.scale),e("div.zoomDiv").show(),e(document.body).mousemove(function(t){var n={x:t.pageX,y:t.pageY};if(n.x<o||n.x>o+d||n.y<a||n.y>a+c)i();else{var s=e(".bigimg").get(0).offsetWidth,p=e(".bigimg").get(0).offsetHeight,v=u/(s-r.xzoom),m=l/(p-r.yzoom),w=n.x-o,f=n.y-a;e("div.zoomDiv").get(0).scrollLeft=w/v,e("div.zoomDiv").get(0).scrollTop=f/m}})})}})(jQuery);var mainUrl,reviewSwiper,reviewModal,reviewId,proudctTogetherId,mediaData={},productData={},hasReivewData=!1;getProductDetails(function(e){mainUrl=e.productMainimgurl,e.productVideoUrl&&e.productVideoImgUrl&&(mediaData.video={videoUrl:e.productVideoUrl,posterUrl:e.productVideoImgUrl,isVideo:!0}),productSeo=e.productSeo,productName=e.proudctName,proudctTogetherId=e.productNeedProTogetherId,renderProductDetails(e),getCouponAreaData(renderCouponAreaData),getProductOption(function(e){renderProductOptions(e)}),getProductSkus(function(e){function t(e){var t=[];return e.forEach(function(e){e.productskuOneImg&&t.push({sku:e.productskuName,url:e.productskuOneImg})}),t}e.length&&buildResult(e),mediaData.skuImgs=t(e)}),renderProductMedia(mediaData),resetProductStock(),$(".product-option-item .radio").on("click",function(){function e(e){var t=-1;return $(".product-thumb-slide .swiper-slide").each(function(i,r){$(r).data("sku")==e&&(t=i)}),t}setTimeout(function(){var t=$(".product-option-item .radio.active");if(t.length&&t.length==$(".product-option-item").length){var i=[],r=null;t.each(function(e,t){i.push($(t).data("text"))}),r=e(i.join(",")),r>-1&&$(".product-slide .swiper-pagination-bullet").eq(r).click()}resetProductStock()},500)}),getCoundownTimeData(2,rednerCountDownAreaOne),addHeaderInfo(e);var t=e.productId,i=accuracyCal(e.productOriginalprice,e.productActoffoff);fbq("track","PageView",{content_ids:t,contents:[{id:t,quantity:999,item_price:i}],content_type:"product",value:i,currency:"USD"}),fbq("track","ViewContent",{content_ids:t,contents:[{id:t,quantity:999,item_price:i}],content_type:"product",value:i,currency:"USD"}),pintrk("track","pagevisit",{em:ml.pinterest_email,value:i*$(".product-qty .product-num").val(),order_quantity:$(".product-qty .product-num").val(),currency:"USD",product_ids:[""+t],line_items:[{product_name:$(".product-name").html(),product_id:t,product_price:i,product_quantity:$(".product-qty .product-num").val()}]})}),getReviewCalData(function(e){$(".product-review-total span").text(e.allReviewNum),renderProudctReviewCal(e)}),getReviewListData(),$(window).on("resize",imageZoomEvent),$(document.body).on("click",".share-click",function(){"share on pinterest"==$(this)[0].title?window.open($(this).data("url")+encodeURIComponent(window.location.href)+"&channel=pinterest&media="+encodeURIComponent($(".product-slide").find(".img").eq(0).data("src"))+"&description="+$("#ml-des").attr("content")):window.open($(this).data("url")+encodeURIComponent(window.location.href))}),$("#product-num-add").on("click",function(){productAdd($(this))}),$("#product-num-sub").on("click",function(){productSub($(this))}),$("#product-reviews .product-tab-item").on("click",function(){var e=$(this),t=e.data("name");e.hasClass("active")||($(this).addClass("active").siblings().removeClass("active"),$('.product-tab-container[data-name="'+t+'"]').addClass("active").siblings().removeClass("active"))}),$(document.body).on("click","#table-pagination li",function(e){getReviewListData($("#product-search-review .product-tab-item.active").data("name")||"");}),$("#add-to-cart").on("click",function(e){debounce(function(){if(isCorrectProduct()){var t=getProductData();if(!t)return removeModal(reviewModal),cannotBuyProductModal(),!1;addToCart(t,function(){window.innerWidth>1023?generateFlyBubble(e,updateProructNumberInCart):(updateProructNumberInCart(),selectCartOrCheckout(t))}),fbq("track","AddToCart",{content_ids:t.cartitemProductId,content_type:"product",value:t.cartitemProductOriginalprice,currency:"USD"}),pintrk("track","addtocart",{em:ml.pinterest_email,value:t.cartitemProductOriginalprice*$(".product-qty .product-num").val(),order_quantity:$(".product-qty .product-num").val(),currency:"USD",product_ids:[""+t.cartitemProductId],line_items:[{product_name:$(".product-name").html(),product_id:t.cartitemProductId,product_price:t.cartitemProductOriginalprice,product_quantity:$(".product-qty .product-num").val()}]}),snaptr("track","ADD_CART",{currency:"USD",price:t.cartitemProductOriginalprice*$(".product-qty .product-num").val(),item_ids:[""+t.cartitemProductId]})}},300)}),$(document.body).on("click",".buy-now",function(){var e=getProductData();isCorrectProduct()&&e&&(fbq("track","InitiateCheckout",{content_ids:e.cartitemProductId,content_type:"product",value:accuracyCal(e.cartitemProductOriginalprice+parseFloat(e.cartitemProductskuMoneystr),e.cartitemProductActoff),currency:"USD"}),pintrk("track","checkout",{em:ml.pinterest_email,value:accuracyCal(e.cartitemProductOriginalprice+parseFloat(e.cartitemProductskuMoneystr),e.cartitemProductActoff)*$(".product-qty .product-num").val(),order_quantity:$(".product-qty .product-num").val(),currency:"USD",product_ids:[""+e.cartitemProductId],line_items:[{product_name:$(".product-name").html(),product_id:e.cartitemProductId,product_price:e.cartitemProductOriginalprice,product_quantity:$(".product-qty .product-num").val()}]}),toBuyNow(e,goToCheckout))}),$(document.body).on("click",".product-review-imgs-item",function(){var e=$(this).data("src"),t=0,i=[];$(this).parent().find(".lazyload").each(function(r,o){var a=$(o).data("src");a==e&&(t=r),i.push(a)}),createReviewSwiper(i,t)}),$(document.body).on("click",".review-swiper-close",function(){$(".review-swiper-box").hide(),removeFixed()}),$("#write-review").on("click",function(e){var t='<div class="write-review-content"><div class="input-group"><label for="write-review-name">User Name</label><input type="text" id="write-review-name" placeholder="Enter your name (public)"></div><div class="input-group"><label class="name">Star Rating</label><div class="write-review-star"><span class="icon star" data-id="1"></span><span class="icon star" data-id="2"></span><span class="icon star" data-id="3"></span><span class="icon star" data-id="4"></span><span class="icon star" data-id="5"></span></div></div><div class="input-group"><label for="write-review-details">Review Text</label><textarea id="write-review-details" placeholder="Write your comments here" rows="5"></textarea></div><div class="input-group"><label>Picture Zone (optional)</label><div class="write-review-img-box"><div class="ml-upload"><input class="upload-review-picture" type="file"><i class="icon plus"></i><div class="spinner"><div class="spinner-border" role="status" aria-hidden="true"></div></div></div><div class="write-review-imglist hide"></div></div></div><div class="input-group"><button class="btn btn-pink write-review-publish">publish</button></div></div>';getReviewId(),reviewModal=createModal({header:{html:"<p>Write A Review...</p>"},body:{html:t}}),reviewModal.addClass("review-modal")}),$(document.body).on("click",".write-review-star .icon",function(e){$(".write-review-star").data("star",$(this).data("id")),$(this).removeClass("star").addClass("star2").prevAll(".icon").removeClass("star").addClass("star2"),$(this).nextAll(".icon").removeClass("star2").addClass("star")}),$(document.body).on("change",".upload-review-picture",function(e){var t=$(this),i=t[0].files[0],r=new FormData,o=$(".write-review-imglist-item").length||0,a=o+1;return!!i&&(t.parent().find(".spinner").show(),t.val(""),r.append("image",i),r.append("type","reviewDetail"),r.append("productSeo",productSeo),r.append("reviewId",reviewId),r.append("reviewimgSortOrder",a),o>=6?(mlModalTip("Upload up to 6 pictures !"),!1):void $.ajax({url:"${APP_PATH}/ImageUpload/thumImageReviewAll",type:"post",data:r,processData:!1,contentType:!1,cache:!1,dataType:"json",success:function(e){100==e.code?($(".write-review-imglist").hasClass("hide")&&$(".write-review-imglist").removeClass("hide"),$(".write-review-imglist").append($('<div class="write-review-imglist-item"><img src="'+e.extend.sqlimageUrl+'"></div>'))):mlModalTip("Failed to upload comment picture !")},error:function(e){mlModalTip("Failed to upload comment picture !")},complete:function(){t.parent().find(".spinner").hide()}}))}),$(document.body).on("click",".write-review-publish",function(e){var t=$("#write-review-name").val(),i=$(".write-review-star").data("star"),r=$("#write-review-details").val();t&&t.trim()?i?r&&r.trim()?saveReviewData({reviewId:reviewId,reviewUname:t,reviewPid:productId,reviewPseoname:productSeo,reviewPname:productName,reviewDetailstr:r,reviewProstarnum:i,reviewFrom:1},function(){removeModal(reviewModal)}):mlModalTip("Comment content cannot be empty !"):mlModalTip("Please Rating Star !"):mlModalTip("Please enter user name !")}),getProductSlideArea(function(e){var t=$(".product-might-like");e.length&&(renderIntroduceProductSlide(t,e),new LazyLoad(t.find(".lazyload"),{root:null,rootMargin:"10px",threshold:0}))}),$(window).on("beforeunload",function(){deleteReviewId(),setPageNum(1)}),$(window).on("scroll",function(){if(window.innerWidth>=1300){var e=$(".product-media-container"),t=$(".product-header").height()-600;window.pageYOffset>=t?e.removeClass("product-media-fixed").css("top",t):e.hasClass("product-media-fixed")||e.addClass("product-media-fixed").css("top","")}}),$(".product-share-btn").on("click",function(){var e='<div class="product-share"><a class="share-item youtube" style="background-image: url(${APP_PATH}/static/pc/img/follow-us.png);" href="https://www.youtube.com/channel/UCbbrYL1KabTMlXFmQhFWtmw?view_as=subscriber" title="megalook youtube"></a><a class="share-item instagram" style="background-image: url(${APP_PATH}/static/pc/img/follow-us.png);" href="https://www.instagram.com/megalookhair/" title="megalook instagram"></a><div class="share-item share-click facebook" data-url="https://www.facebook.com/sharer/sharer.php?u=" title="share on facebook"></div><div class="share-item share-click pinterest" data-url="https://www.pinterest.com/pin/create/button/?url=" title="share on pinterest"></div><div class="share-item share-click whatsapp" data-url="https://api.whatsapp.com/send?text=" title="share on whatsapp"></div></div>';createModal({header:{html:"<p>Product Share</p>"},body:{html:e}})});</script>
<script>function renderFbReviews(e){var i,o=e&&e.match(/<iframe\s*.*?><\/iframe>/g)||[],t=o.length,r='<div style="height: 36px; line-height: 36px; text-align: center;; font-size: 16px; -webkit-overflow-scrolling: touch; background-color: #558dfd; color: #fff;">Real-time Feedback on Facebook</div>';if(t){if(r+=o.splice(0,5).join(""),t>5){i=$('<div class="fb-reviews-box hide"  style="position: fixed; top: 0; left: 0; z-index: 9999999999; width: 100%; height: 100%; background-color: rgba(0, 0, 0, .5);"></div');var s='<div class="fb-container" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; max-width: 500px; background-color: #fff;"><div class="fb-review-head" style="text-align: center;"><div style="height: 36px; line-height: 36px; font-size: 16px; background-color: #558dfd; color: #fff;">Real-time Feedback on Facebook</div><span class="icon close" style="position: absolute; top: 0; right: 0; width: 32px; height: 32px; color: #fff; font-size: 18px; cursor: pointer;"></span><div style="height: 30px; line-height: 30px; background: #fff; color: #636363; font-size: 16px;">To see how they experience it !</div></div><div class="fb-review-body" style="height: 412px; overflow-y: auto">'+o.join("")+"</div></div";r+='<div class="fb-review-more" style="text-align: center; color: #4080ff; cursor: pointer;">More Feedbacks &gt;</span>',i.html(s)}$(".product-fb-reviews").html(r),$(document.body).append(i)}$(document.body).on("click",".fb-review-more",function(){addFixed(),$(".fb-reviews-box").removeClass("hide")}),$(".fb-reviews-box").on("click",function(e){e.target==this&&(removeFixed(),$(".fb-reviews-box").addClass("hide"))}),$(".fb-reviews-box .close").on("click",function(e){removeFixed(),$(".fb-reviews-box").addClass("hide")})}function getfbReviewsData(e){$.ajax({url:"${APP_PATH}/MlbackProfbReview/getProfbreviewAreaDetailListByPid",type:"post",data:JSON.stringify({profbreviewAreaPid:productId}),dataType:"json",contentType:"application/json",success:function(e){100==e.code&&renderFbReviews(e.extend.mlbackProfbreviewAreaOne.profbreviewAreaDesc)},error:function(e){}})}getfbReviewsData(renderFbReviews);</script>

<script>
function getTogetherData(callback) {
	$.ajax({
		url: '${APP_PATH}/productTogether/getProtalOneMlbackProductTogetherDetail',
		data: JSON.stringify({ "producttogetherId": proudctTogetherId, "producttogetherSupercateId": productId }),
		dataType: 'json',
		contentType: 'application/json',
		type: "post",
		success: function (data) {
			if (data.code == 100) {
				callback && callback(data.extend);
			}
		}
	});
}
function initialProductTogetherPrice() {
	$('.product-together-info-item').each(function(idx, item) {
		var $item = $(item);
		$item.find('.product-together-oprice').text('$' + accuracyCal(parseFloat($item.data('price')) + parseFloat($item.find('.product-together-select').find('option:checked').data('price')), 100));
		$item.find('.product-together-dprice').text('$' + accuracyCal(parseFloat($item.data('price')) + parseFloat($item.find('.product-together-select').find('option:checked').data('price')), $item.data('dis')));
	});
}
function handleProductTogetherPrice() {
	var allDprice = 0, allOprice = 0;
	$('input[name="productTogehter"]:checked').each(function(idx, item) {
		var $ptitem = $(this).parents('.product-together-info-item');
		allOprice += parseFloat(accuracyCal(parseFloat($ptitem.data('price')) + parseFloat($ptitem.find('.product-together-select').find('option:checked').data('price')), 100));
		allDprice += parseFloat(accuracyCal(parseFloat($ptitem.data('price')) + parseFloat($ptitem.find('.product-together-select').find('option:checked').data('price')), $ptitem.data('dis')));
	});

	$('.product-together-cal').find('.product-together-dprice').text('$' + accuracyCal(allDprice, 100));
	$('.product-together-cal').find('.product-together-oprice').text('$' + accuracyCal(allOprice, 100));
}
function renderTogetherData(data) {
	function renderProductTogetherSKus(data) {
		var optionHtml = '';
		data.forEach(function(item, idx) {
			optionHtml += '<option data-id="'+ item.productskuId +'" data-code="'+ item.productskuCode +'" data-price="'+ item.productskuMoney +'" data-name="'+ item.productskuName +'" value="'+ item.productskuName +'">'+ item.productskuName +'</option>';
		});
		return optionHtml;
	}
	
	function generateProudctProp(data) {
		var propData = []
		data.forEach(function(item, idx) {
			var cData = {
					'pid': [],
					'pname': []
				};
			item.forEach(function(item) {
				cData.pid.push(item.productattrnameId);
				cData.pname.push(item.productattrnameName);
			});
			propData.push(cData)
		});
		return propData;
	}
	var productDatas = data.mlbackProductList,
		productSkuDatas = data.mlbackProductSkuTogetherList,
		productSkuProps = generateProudctProp(data.propAttributeNameListList),
		len = productDatas.length;

	if (data.mlbackProductTogetherRes && len && productSkuDatas.length && productDatas.length == productSkuDatas.length && productSkuProps.length == productSkuDatas.length) {
		var imgsHtml = '', otherHtml = '';
		productDatas.forEach(function(item, idx) {
			var productLink = '${APP_PATH}/' + item.productSeo + '.html';
			imgsHtml += '<div class="product-together-img-item show">' +
				'<a class="lazyload" href="'+ productLink +'" data-src="'+ item.productMainimgurl +'"></a>' +
				(len > 1 && idx < len - 1 ? '<div class="product-together-plus show">+</div>' : '') +
			'</div>';

			otherHtml += '<div class="product-together-info-item" data-dis="'+ item.productActoffoff +'" data-price="'+ item.productOriginalprice +'" data-id="'+ item.productId +'" data-seo="'+ item.productSeo +'" data-name="'+ item.productName +'" data-img="'+ item.productMainimgurl +'">' +
				'<input class="product-together-check" data-num="'+ idx +'" name="productTogehter" type="checkbox" checked />' +
				'<a class="proudct-together-name" href="'+ productLink +'">' + item.productName + '</a>' +
				'<select class="product-together-select" data-pname="'+ ((productSkuProps[idx]['pname']).join(',')) +'" data-pid="'+ ((productSkuProps[idx]['pid']).join(',')) +'">' + renderProductTogetherSKus(productSkuDatas[idx]) + '</select>' +
				'<span class="product-together-dprice"></span>' +
				'<span class="product-together-oprice"></span>' +
			'</div>';
		});
		$('.product-together-imgs').html(imgsHtml);
		$('.product-together-other').html(otherHtml);
		$('.product-together-box').removeClass('hide');

		new LazyLoad($('.product-together-imgs').find('.lazyload'), {
			root: null,
			rootMargin: "10px",
			threshold: 0
		});

		initialProductTogetherPrice();
		handleProductTogetherPrice();

		$(document.body).on('change', '.product-together-select', function() {
			var $ptitem = $(this).parents('.product-together-info-item');
			$ptitem.find('.product-together-oprice').text('$' + accuracyCal(parseFloat($ptitem.data('price')) + parseFloat($ptitem.find('.product-together-select').find('option:checked').data('price')), 100));
			$ptitem.find('.product-together-dprice').text('$' + accuracyCal(parseFloat($ptitem.data('price')) + parseFloat($ptitem.find('.product-together-select').find('option:checked').data('price')), $ptitem.data('dis')));

			handleProductTogetherPrice();
		});

		$('.product-together-check').on('change', function() {
			var $el;
			if ($(this).prop('checked')) {
				$('.product-together-img-item').eq($(this).data('num')).removeClass('hide').addClass('show');
			} else {
				$('.product-together-img-item').eq($(this).data('num')).addClass('hide').removeClass('show');
			}
			$el = $('.product-together-img-item.show');
			$('.product-together-plus').removeClass('hide');
			$el.eq($el.length - 1).find('.product-together-plus').addClass('hide').removeClass('show');

			handleProductTogetherPrice();
		});
	}
}
// proudctTogetherId = 4;
if (proudctTogetherId != 999) {
	function addProductTogetherSelectCart(reqData, callback) {
		var len = reqData.length;
		if (len == 1) {
			addToCart(reqData.pop(), callback);
		}

		if (len > 1) {
			var formData = new FormData();
			formData.append('addMoreProToCartTeams', JSON.stringify(reqData));
			$.ajax({
				url: "${APP_PATH }/MlbackCart/toAddMoreProToCart",
				type: "post",
				processData: false,
				contentType: false,
				cache: false,
				data: formData,
				success: function (data) {
					if (data.code == 100) {
						callback && callback();
					} else {
						sysModalTip();
					}
				},
				error: function (err) {
					sysModalTip();
				}
			});
		}
		
		if (len < 1) {
			modalTip('At least one product needs to be selected...');
		}
	}
	function getSelectProductTogether() {
		var productTogetherCart = [];
		$('input[name="productTogehter"]:checked').each(function(idx, item) {
			var $item = $(this).parents('.product-together-info-item');
			var productData = {};
			var selectedOption;
			
			productData["cartitemProductId"] = $item.data('id');
			productData["cartitemProductSeoName"] = $item.data('seo');
			productData["cartitemProductName"] = $item.data('name');
			productData["cartitemProductOriginalprice"] = $item.data('price');
			productData["cartitemProductMainimgurl"] = $item.data('img');
			productData["cartitemProductActoff"] = $item.data('dis');
	
			productData["cartitemProductskuIdstr"] = $item.find('.product-together-select').data('pid');
			productData["cartitemProductskuIdnamestr"] = $item.find('.product-together-select').data('pname');

			selectedOption = $item.find('.product-together-select option:selected');
			productData["cartitemProductskuId"] = selectedOption.data('id');
			productData["cartitemProductskuName"] = selectedOption.data('name');
			productData["cartitemProductskuCode"] = selectedOption.data('code');
			productData["cartitemProductskuMoneystr"] = selectedOption.data('price');
			productData["cartitemProductNumber"] =  1;
			
			productTogetherCart.push(productData);
		});

		return productTogetherCart;
	}
	function cartListCheckout(reqData, callback) {
		$.ajax({
			url: '${APP_PATH}/MlbackCart/cartToOrder',
			data: JSON.stringify(reqData),
			dataType: 'json',
			contentType: 'application/json',
			type: "post",
			async: false,
			success: function (data) {
				if (data.code == 100) {
					callback && callback();
				} else {
					sysModalTip();
				}
			},
			error: function(err) {
				sysModalTip();
			}
		});
	}
	function productTogetherCheckout() {
		function getCartListData(callback) {
			$.ajax({
				url: '${APP_PATH}/MlbackCart/getCartitemIdDetails',
				type: 'post',
				success: function (data) {
					if (data.code == 100) {
						callback && callback(data.extend.mlfrontCartItemListRes);
					} else {
						sysModalTip();
					}
				}
			});
		}

		getCartListData(function(data) {
			var checkoutData = [];
			if (data && data.length) {
				data.forEach(function(item, idx) {
					checkoutData.push({
						"cartitemId": item.cartitemId,
				        "cartitemProductId": item.cartitemProductId,
				        "cartitemProductNumber": item.cartitemProductNumber
					});
				});
				cartListCheckout(checkoutData, function() {
					window.location.href = '${APP_PATH}/MlbackCart/toCheakOut#product-together';
				});
			} else {
				sysModalTip();
			}
		});
	}
	getTogetherData(renderTogetherData);
	$('#product-together-sadd').on('click', function() {
		payLoading();
		addProductTogetherSelectCart(getSelectProductTogether(), productTogetherCheckout);
	});
}
</script>
<script type="text/javascript">
	$('#product-search-review .product-tab-item').on('click', function() {
		var tabName = parseInt($(this).data('name'), 10);
		setPageNum(1);
		getReviewListData(tabName || '');
	});
</script>