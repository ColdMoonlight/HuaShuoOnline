<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<% pageContext.setAttribute("APP_PATH", request.getContextPath()); %>
<script>
function addHeaderInfo(productData) {
	var productNameStr = productData.productName,
		productMetaDescStr = productData.productMetaDesc,
		productSeoStr = productData.productSeo,
		urlStr = 'https://www.megalook.com/' + productSeoStr + '.html',
		imageStr = productData.productMainimgurl,
		amountStr = accuracyCal(productData.productOriginalprice, productData.productActoffoff),
		productIdStr = productData.productId;
	var meta = $('<meta property = "og:title" content ="' + productNameStr + '">' +
		'<meta property = "og:description" content = "' + productMetaDescStr + '" >' +
		'<meta property = "og:url" content = "' + urlStr + '" >' +
		'<meta property = "og:image" content = "' + imageStr + '" >' +
		'<meta property = "product:brand" content = "MegaLook" >' +
		'<meta property = "product:availability" content = "in stock" >' +
		'<meta property = "product:condition" content = "new" > ' +
		'<meta property = "product:price:amount" content = "' + amountStr + '" >' +
		'<meta property = "product:price:currency" content = "USD" >' +
		'<meta property = "product:retailer_item_id" content = "' + productIdStr + '" >' +
		'');
	$(document.head).append(meta);
}
</script>
<script>!function($){$.fn.imagezoom=function(options){var settings={xzoom:300,yzoom:300,scale:3},self=this;function mouseOutImage(){$(document.body).unbind("mousemove"),$("div.zoomDiv").remove()}options&&$.extend(settings,options),$(this).bind("mouseover",(function(ev){var imageLeft=$(this).offset().left,imageTop=$(this).offset().top,imageWidth=$(this).get(0).offsetWidth,imageHeight=$(this).get(0).offsetHeight,boxLeft=$(this).parent().offset().left,boxTop=$(this).parent().offset().top,boxWidth=$(this).parent().width(),boxHeight=$(this).parent().height(),imageUrl=$(this).attr("rel");0==$("div.zoomDiv").get().length&&$(document.body).append("<div class='zoomDiv'><img class='bigimg' src='"+imageUrl+"'/></div>"),$(this).css("cursor","crosshair"),$("div.zoomDiv").css({top:boxTop,left:boxLeft+boxWidth}),$("div.zoomDiv").width(settings.xzoom),$("div.zoomDiv").height(settings.yzoom),$("div.zoomDiv .bigimg").width(settings.xzoom*settings.scale),$("div.zoomDiv .bigimg").height(settings.yzoom*settings.scale),$("div.zoomDiv").show(),$(document.body).mousemove((function(e){var mouse_x=e.pageX,mouse_y=e.pageY;if(mouse_x<imageLeft||mouse_x>imageLeft+imageWidth||mouse_y<imageTop||mouse_y>imageTop+imageHeight)mouseOutImage();else{var bigWidth=$(".bigimg").get(0).offsetWidth,bigHeight=$(".bigimg").get(0).offsetHeight,scalex=boxWidth/(bigWidth-settings.xzoom),scaley=boxHeight/(bigHeight-settings.yzoom),xposs=mouse_x-imageLeft,yposs=mouse_y-imageTop;$("div.zoomDiv").get(0).scrollLeft=xposs/scalex,$("div.zoomDiv").get(0).scrollTop=yposs/scaley}}))}))}}(jQuery);function generateFlyBubble(event,callback){$('<img class="ml-flyer" src="'+mainUrl+'" />').fly({start:{left:event.pageX-window.pageXOffset,top:event.pageY-window.pageYOffset},end:{left:window.innerWidth-30,top:150,width:0,height:0},onEnd:function(){this.destroy(),callback()}})}function updateProductData(selectedKeys){var productQty=mapSet[selectedKeys.join(",")],productSku=mapItems[selectedKeys.join(",")]||{};if(Object.keys(mapSet).length&&Object.keys(mapItems).length){$(".product-qty .product-num").data("count",productQty.count).data("productsku",productSku);var productSkuMoney=productSku.productskuMoney;productSkuMoney?updateProductPrice(productSkuMoney):updateProductPrice()}else mlModalTip("I'm sorry that the product cannot be purchased for the time being. If necessary, please contact customer service !")}function updateProductPrice(price){var data=$(".product-details").data("product");function getSkuPrice(){return price&&parseFloat(price)?parseFloat(price):0}$(".product-define-price").text("$"+(data.productPrice+getSkuPrice()).toFixed(2)),$(".product-now-price").text("$"+accuracyCal(data.productPrice+getSkuPrice(),data.productDiscount))}function getProductData(){var productData={},productDetails=$(".product-details").data("product")||{},productSKu=$(".product-qty .product-num").data("productsku");return!(!productSKu||!Object.keys(productSKu).length)&&(productData.cartitemProductId=productDetails.proudctId,productData.cartitemProductSeoName=productDetails.productSeo,productData.cartitemProductName=productDetails.productName,productData.cartitemProductOriginalprice=productDetails.productPrice,productData.cartitemProductMainimgurl=productDetails.productMainImgUrl,productData.cartitemProductActoff=productDetails.productDiscount,productData.cartitemProductskuIdstr=optionIdArr.join(","),productData.cartitemProductskuIdnamestr=Object.keys(optionObj).join(","),productData.cartitemProductskuId=productSKu.productskuId,productData.cartitemProductskuName=productSKu.productskuName,productData.cartitemProductskuCode=productSKu.productskuCode,productData.cartitemProductskuMoneystr=productSKu.productskuMoney,productData.cartitemProductNumber=parseInt($(".product-qty .product-num").val()),productData)}function addToCart(reqData,callback){$.ajax({url:"${APP_PATH}/MlbackCart/toAddToCart",data:JSON.stringify(reqData),type:"post",dataType:"json",contentType:"application/json",success:function(data){100==data.code?callback&&callback():mlModalTip("Failed to add products to cart !</p>")},error:function(err){sysModalTip()}})}function toBuyNow(reqData,callback){$.ajax({url:"${APP_PATH}/MlbackCart/toBuyNow",data:JSON.stringify(reqData),type:"post",dataType:"json",contentType:"application/json",success:function(data){100==data.code?callback():mlModalTip("I'm sorry, temporarily unable to settlement, please try again later !")},error:function(err){sysModalTip()}})}function renderProductMedia(data){function stopVideo(){$("#ml-video")[0]&&$("#ml-video")[0].pause()}var htmlStr=$(".product-slide .swiper-wrapper").html(),htmlVideoThumb="",htmlVideo="";data.video&&(htmlVideoThumb='<div class="swiper-slide"><div class=" lazyload" data-src="'+data.video.posterUrl+'"></div></div>',htmlVideo='<div class="swiper-slide"><video id="ml-video" controls preload="none" poster="'+data.video.posterUrl+'"><source src="'+data.video.videoUrl+'" type="video/mp4" /></video></div>'),$(".product-thumb-slide .swiper-wrapper").html(htmlVideoThumb+htmlStr),$(".product-slide .swiper-wrapper").html(htmlVideo+htmlStr),$("#ml-video").on("play",function(){pintrk("track","watchvideo")}),new LazyLoad($(".product-media .lazyload"),{root:null,rootMargin:"10px",threshold:0});var swiperThumb=new Swiper(".product-thumb-slide",{direction:"vertical",slidesPerView:6,spaceBetween:5,freeMode:!0,navigation:{nextEl:".product-thumb-slide .swiper-button-next",prevEl:".product-thumb-slide .swiper-button-prev"},on:{slideChangeTransitionStart:function(){stopVideo()}}}),swiperMain=new Swiper(".product-slide",{pagination:{el:".product-slide .swiper-pagination",clickable:!0},navigation:{nextEl:".product-slide .swiper-button-next",prevEl:".product-slide .swiper-button-prev"},on:{slideChangeTransitionStart:function(){stopVideo()}},thumbs:{swiper:swiperThumb}});imageZoomEvent()}function renderProductDetails(data){$(".product-details").data("product",{proudctId:data.productId,productName:data.productName,productDiscount:data.productActoffoff,productMainImgUrl:data.productMainimgurl,productPrice:data.productOriginalprice,productSeo:data.productSeo}),$(".product-name").text(data.productName),$(".product-price").html('<div class="name">Total Price: </div><div class="product-define-price">$'+data.productOriginalprice.toFixed(2)+'</div><div class="product-now-price">$'+accuracyCal(data.productOriginalprice,data.productActoffoff)+"</div>"),$('.product-tab-container[data-name="desc"]').html(data.productDesc)}function createReviewSwiper(imgs,activeNum){var slideImgs=imgs.reduce((function(acc,img){return acc+='<div class="swiper-slide"><img class="lazyload" src="'+img+'" /></div>'}),"");if(reviewSwiper)$(".review-swiper-box .swiper-wrapper").html(slideImgs),reviewSwiper.updateSlides(),reviewSwiper.slideTo(activeNum,0,!1),$(".review-swiper-box").show(),addFixed();else{var $reviewSwiper=$('<div class="review-swiper-box"><div id="review-swiper" class="swiper-container"><div class="swiper-wrapper">'+slideImgs+'</div><div class="swiper-pagination"></div><div class="swiper-button-next"></div><div class="swiper-button-prev"></div></div><div class="review-swiper-close"><span class="icon close"></span></div><div>');$(document.body).append($reviewSwiper),addFixed(),(reviewSwiper=new Swiper("#review-swiper",{pagination:{el:".swiper-pagination",type:"fraction"},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})).slideTo(activeNum,0,!1)}}function getProductDetails(callback){$.ajax({url:"${APP_PATH}/MlbackProduct/getOneMlbackProductDetail",data:JSON.stringify({productId:productId}),dataType:"json",contentType:"application/json",type:"post",async:!1,success:function(data){100==data.code&&callback(data.extend.mlbackProductOne)}})}function selectCartOrCheckout(data){var cartCheckoutHtml='<div class="cart-checkout-product"><div class="lazyload" data-src="'+data.cartitemProductMainimgurl+'"></div><div class="cart-checkout-data"><div class="cart-checkout-productname">'+data.cartitemProductName+'</div><div class="cart-checkout-productprice"><div class="name">Price: </div><div class="value">$'+accuracyCal(data.cartitemProductOriginalprice+parseFloat(data.cartitemProductskuMoneystr),data.cartitemProductActoff)+'</div></div><div class="btn-group"><a class="btn" href="javascript:goToCartList();">View Cart</a><a class="btn btn-pink buy-now">Checkout</a></div></div></div>',cartOrCheckoutModal=createModal({header:{html:"<p>Product successfully added to your cart!</p>"},body:{html:cartCheckoutHtml},footer:{isShow:!0,html:"Free Gift For Every Order!"},autoClose:!1});new LazyLoad(cartOrCheckoutModal.find(".lazyload"),{root:null,rootMargin:"10px",threshold:0}),cartOrCheckoutModal.addClass("cart-checkout"),setTimeout((function(){removeModal(cartOrCheckoutModal)}),5e3)}function toPayInstance(reqData){$.ajax({url:"${APP_PATH}/ProPay/toBuyNowPay",data:JSON.stringify(reqData),type:"post",dataType:"json",contentType:"application/json",success:function(data){100==data.code?$.ajax({url:"${APP_PATH}/MlfrontOrder/proDetailOrderToPayInfo",data:JSON.stringify({orderId:data.extend.OrderIdBuyNowPay,orderPayPlate:1,orderProNumStr:reqData.cartitemProductNumber}),type:"post",dataType:"json",contentType:"application/json",success:function(data){100==data.code?goTopayInstance():sysModalTip()},error:function(err){sysModalTip()}}):sysModalTip()},error:function(data){sysModalTip()}})}function getReviewCalData(callback){$.ajax({url:"${APP_PATH}/MlfrontReview/getMlfrontReviewCount",data:JSON.stringify({reviewPid:productId}),type:"post",dataType:"json",contentType:"application/json",success:function(data){100==data.code?callback&&callback(data.extend):refreshPageModal()},error:function(err){refreshPageModal()}})}function getReviewListData(){$.ajax({url:"${APP_PATH}/MlfrontReview/getMlfrontReviewByProductIdAndPage",data:JSON.stringify({reviewPid:productId,reviewUid:getPageNum()}),type:"post",dataType:"json",contentType:"application/json",async:!1,success:function(data){if(100==data.code){var pageInfo=data.extend.pageInfo;pageInfo.list.length?(renderProductReviewList(pageInfo.list,data.extend.imgUrlStrListst),renderTablePagination(pageInfo)):$(".product-review-body").html('<p class="text-error">here are no comments yet, you can just click the <i>Write a Reveiw</i> button to write a comment !</p>')}else refreshPageModal()},error:function(err){refreshPageModal()}})}function renderProudctReviewCal(data){var reviewNum=data.allReviewNum,reviewStarList=data.StartNumList,total=reviewStarList?reviewStarList.reduce((function(acc,item){return acc+=item.startCount*item.startNum}),0):0,avgStar=Math.ceil(total/reviewNum);htmlStr="";for(var i=4,percent=0;i>=0;i-=1)percent=data.allReviewNum?100*reviewStarList[i].startCount/data.allReviewNum:0,htmlStr+='<div class="product-review-star-item"><div class="stars">'+(i+1)+' star</div><div class="progress"><div class="progress-inner" style="width: '+percent+'%"></div></div><div class="data">'+percent.toFixed(2)+"%</div></div>";$(".product-review-avgstar .icon").each((function(idx,item){idx<avgStar&&$(item).removeClass(".star").addClass("star2")})),$(".product-review-star-list").html(htmlStr)}function renderProductReviewList(reviewList,imgList){for(var htmlStr="",i=0,len=reviewList.length;i<len;i++){htmlStr+='<div class="product-review-item"><div class="product-review-item-title"><div class="product-reivewer-img lazyload" data-src="'+reviewList[i].reviewUimgurl+'"></div><div class="product-review-item-data"><div class="product-review-stars">';for(var j=0;j<5;j++)j<reviewList[i].reviewProstarnum?htmlStr+='<span class="icon star2"></span>':htmlStr+='<span class="icon star"></span>';htmlStr+='</div><div class="product-review-author">'+reviewList[i].reviewUname+'</div></div><div class="product-review-date">'+reviewList[i].reviewCreatetime+'</div></div><div class="proudct-review-item-text">'+reviewList[i].reviewDetailstr+'</div><div class="product-review-item-imgs">';for(var imgLen=imgList[i].length<=6?imgList[i].length:6,k=0;k<imgLen;k++)htmlStr+='<div class="product-review-imgs-item lazyload" data-src="'+imgList[i][k]+'"></div>';htmlStr+="</div></div>"}$(".product-review-list").html(htmlStr),new LazyLoad($(".product-review-list .lazyload"),{root:null,rootMargin:"10px",threshold:0})}function deleteReviewId(){reviewId&&$.ajax({url:"${APP_PATH }/MlfrontReview/delete",type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify({reviewId:reviewId}),success:function(data){}})}function getReviewId(){deleteReviewId(),$.ajax({url:"${APP_PATH }/MlfrontReview/initializaReview",type:"post",dataType:"json",contentType:"application/json",async:!1,success:function(data){100==data.code?reviewId=data.extend&&data.extend.mlfrontReview&&data.extend.mlfrontReview.reviewId:sysModalTip()},error:function(err){sysModalTip()}})}function saveReviewData(reqData,callback){$.ajax({url:"${APP_PATH}/MlfrontReview/save",type:"post",data:JSON.stringify(reqData),dataType:"json",contentType:"application/json",async:!1,success:function(result){100==result.code?(mlModalTip("Successful operation. New comment information needs to be reviewed before it can be displayed !"),reviewId=null,callback&&callback()):mlModalTip("Operation Failed !")},error:function(){mlModalTip("Operation Failed !")}})}var mediaData={},productData={},mainUrl,reviewSwiper,reviewModal,reviewId,hasReivewData=!1;function imageZoomEvent(){window.innerWidth<1300?$(".product-slide.product-zoom").find(".img").off("mouseover"):$(".product-slide.product-zoom").find(".img").imagezoom()}getProductDetails((function(data){mainUrl=data.productMainimgurl,data.productVideoUrl&&data.productVideoImgUrl&&(mediaData.video={videoUrl:data.productVideoUrl,posterUrl:data.productVideoImgUrl,isVideo:!0}),renderProductMedia(mediaData),productSeo=data.productSeo,productName=data.proudctName,renderProductDetails(data),getCouponAreaData(renderCouponAreaData),getProductOption((function(data){renderProductOptions(data)})),getProductSkus((function(data){data.length&&buildResult(data)})),getCoundownTimeData(2,rednerCountDownAreaOne);addHeaderInfo(data);var fbpid=data.productId,fbprice=accuracyCal(data.productOriginalprice,data.productActoffoff);fbq("track","PageView",{content_ids:fbpid,contents:[{id:fbpid,quantity:999,item_price:fbprice}],content_type:"product",value:fbprice,currency:"USD"}),fbq("track","ViewContent",{content_ids:fbpid,contents:[{id:fbpid,quantity:999,item_price:fbprice}],content_type:"product",value:fbprice,currency:"USD"})})),$(window).on("resize",imageZoomEvent),$(".share-item").on("click",(function(){"share on pinterest"==$(this)[0].title?window.open($(this).data("url")+encodeURIComponent(window.location.href)+"&channel=pinterest&media="+encodeURIComponent($(".product-slide").find("img").eq(0).data("src"))+"&description="+$("#ml-des").attr("content")):window.open($(this).data("url")+encodeURIComponent(window.location.href));})),$("#product-num-add").on("click",(function(){productAdd($(this))})),$("#product-num-sub").on("click",(function(){productSub($(this))})),$(".product-tab-item").on("click",(function(){var $this=$(this),tabName=$this.data("name");$this.hasClass("active")||$('.product-tab-container[data-name="'+tabName+'"]').addClass("active").siblings().removeClass("active"),"review"!=tabName||hasReivewData||(getReviewCalData((function(data){$(".product-review-total span").text(data.allReviewNum),renderProudctReviewCal(data)})),getReviewListData(),hasReivewData=!0,$("#loader-box").hide())})),$(document.body).on("click","#table-pagination li",(function(e){getReviewListData()})),$("#add-to-cart").on("click",(function(evt){debounce((function(){if(isCorrectProduct()){var reqData=getProductData();if(!reqData)return removeModal(reviewModal),cannotBuyProductModal(),!1;addToCart(reqData,(function(){window.innerWidth>1023?generateFlyBubble(evt,updateProructNumberInCart):(updateProructNumberInCart(),selectCartOrCheckout(reqData))})),fbq("track","AddToCart",{content_ids:reqData.cartitemProductId,content_type:"product",value:reqData.cartitemProductOriginalprice,currency:"USD"}),pintrk("track","addtocart",{value:reqData.cartitemProductOriginalprice,order_quantity:$(".product-qty .product-num").val(),currency:"USD"})}}),300)})),$(document.body).on("click",".buy-now",(function(){var reqData=getProductData();isCorrectProduct()&&reqData&&(fbq("track","InitiateCheckout",{content_ids:reqData.cartitemProductId,content_type:"product",value:accuracyCal(reqData.cartitemProductOriginalprice+parseFloat(reqData.cartitemProductskuMoneystr),reqData.cartitemProductActoff),currency:"USD"}),pintrk("track","checkout",{value:accuracyCal(reqData.cartitemProductOriginalprice+parseFloat(reqData.cartitemProductskuMoneystr),reqData.cartitemProductActoff),order_quantity:$(".product-qty .product-num").val(),currency:"USD"}),toBuyNow(reqData,goToCheckout))})),$(document.body).on("click",".product-review-imgs-item",(function(){var activeImg=$(this).data("src"),activeNum=0,imgs=[];$(this).parent().find(".lazyload").each((function(idx,item){var img=$(item).data("src");img==activeImg&&(activeNum=idx),imgs.push(img)})),createReviewSwiper(imgs,activeNum)})),$(document.body).on("click",".review-swiper-close",(function(){$(".review-swiper-box").hide(),removeFixed()})),$("#write-review").on("click",(function(e){var writeReviewHtml='<div class="write-review-content"><div class="input-group"><label for="write-review-name">User Name</label><input type="text" id="write-review-name" placeholder="Enter your name (public)"></div><div class="input-group"><label class="name">Star Rating</label><div class="write-review-star"><span class="icon star" data-id="1"></span><span class="icon star" data-id="2"></span><span class="icon star" data-id="3"></span><span class="icon star" data-id="4"></span><span class="icon star" data-id="5"></span></div></div><div class="input-group"><label for="write-review-details">Review Text</label><textarea id="write-review-details" placeholder="Write your comments here" rows="5"></textarea></div><div class="input-group"><label>Picture Zone (optional)</label><div class="write-review-img-box"><div class="ml-upload"><input class="upload-review-picture" type="file"><i class="icon plus"></i><div class="spinner"><div class="spinner-border" role="status" aria-hidden="true"></div></div></div><div class="write-review-imglist hide"></div></div></div><div class="input-group"><button class="btn btn-pink write-review-publish">publish</button></div></div>';getReviewId(),(reviewModal=createModal({header:{html:"<p>Write A Review...</p>"},body:{html:writeReviewHtml}})).addClass("review-modal")})),$(document.body).on("click",".write-review-star .icon",(function(e){$(".write-review-star").data("star",$(this).data("id")),$(this).removeClass("star").addClass("star2").prevAll(".icon").removeClass("star").addClass("star2"),$(this).nextAll(".icon").removeClass("star2").addClass("star")})),$(document.body).on("change",".upload-review-picture",(function(e){var $this=$(this),file=$this[0].files[0],formData=new FormData,reviewImgLen=$(".write-review-imglist-item").length||0,reviewImgOrder=reviewImgLen+1;return!!file&&($this.parent().find(".spinner").show(),$this.val(""),formData.append("image",file),formData.append("type","reviewDetail"),formData.append("productSeo",productSeo),formData.append("reviewId",reviewId),formData.append("reviewimgSortOrder",reviewImgOrder),reviewImgLen>=6?(mlModalTip("Upload up to 6 pictures !"),!1):void $.ajax({url:"${APP_PATH}/ImageUpload/thumImageReviewAll",type:"post",data:formData,processData:!1,contentType:!1,cache:!1,dataType:"json",success:function(data){100==data.code?($(".write-review-imglist").hasClass("hide")&&$(".write-review-imglist").removeClass("hide"),$(".write-review-imglist").append($('<div class="write-review-imglist-item"><img src="'+data.extend.sqlimageUrl+'"></div>'))):mlModalTip("Failed to upload comment picture !")},error:function(err){mlModalTip("Failed to upload comment picture !")},complete:function(){$this.parent().find(".spinner").hide()}}))})),$(document.body).on("click",".write-review-publish",(function(e){var username=$("#write-review-name").val(),starNum=$(".write-review-star").data("star"),details=$("#write-review-details").val();username&&username.trim()?starNum?details&&details.trim()?saveReviewData({reviewId:reviewId,reviewUname:username,reviewPid:productId,reviewPseoname:productSeo,reviewPname:productName,reviewDetailstr:details,reviewProstarnum:starNum,reviewFrom:1},(function(){removeModal(reviewModal)})):mlModalTip("Comment content cannot be empty !"):mlModalTip("Please Rating Star !"):mlModalTip("Please enter user name !")})),getProductSlideArea((function(data){var $el=$(".product-footer");data.length&&(renderIntroduceProductSlide($el,data),new LazyLoad($el.find(".lazyload"),{root:null,rootMargin:"10px",threshold:0}))})),$(window).on("beforeunload",(function(){deleteReviewId(),setPageNum(1)}));</script>