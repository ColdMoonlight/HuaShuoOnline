<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<% pageContext.setAttribute("APP_PATH", request.getContextPath()); %>
<script>function getProductOrderList(callback){$.ajax({url:"${APP_PATH}/MlfrontOrder/getNowOrderDetail",type:"get",async:!1,cache:!1,success:function(data){100==data.code&&callback&&callback(data.extend)}})}function getProvinceData(reqData,callback){$.ajax({url:"${APP_PATH}/MlfrontAddress/getAreafreightMoney",data:JSON.stringify(reqData),async:!1,type:"post",dataType:"json",contentType:"application/json",async:!1,success:function(data){100==data.code&&callback&&callback(data.extend)}})}function getUserInfo(callback){$.ajax({url:"${APP_PATH}/MlfrontAddress/getOneMlfrontAddressDetailByUinfo",type:"post",dataType:"json",async:!1,success:function(data){callback&&callback(data.extend)}})}function updateOrderNum(r,t,e){var d=r.parents(".order-item").data("orderitem")||null,a={orderitemId:parseInt(d.orderitemId),orderitemPskuNumber:t};$.ajax({url:"${APP_PATH}/MlfrontOrder/updateOrderItemNum",data:JSON.stringify(a),type:"post",dataType:"json",contentType:"application/json",success:function(u){if(100==u.code){var o=$(".order-list").data("itemnumarr").split(","),i=$(".order-list").data("itemidarr").split(",");i.forEach(function(r,e){""+r==""+a.orderitemId&&(o[e]=t)}),$(".order-list").data("itemnumarr",o.join(",")),updateProructNumberInCart(),d.orderitemPskuNumber=t,r.parents(".order-item").data("orderitem",d),e&&e(),updateProductNumSuccessModal()}else r.find(".product-num").val(d.orderitemPskuNumber),updateProductNumFailModal()},error:function(){r.find(".product-num").val(d.cartitemProductNumber),updateProductNumFailModal()}})}function deleteOrderProduct(el,callback){var targetData=el.data("orderitem")||null,orderitemId=parseInt(targetData.orderitemId),reqData={orderitemId:orderitemId};function resetOrderListData(){var itemIdArr=$(".order-list").data("itemidarr").split(",");itemIdArr=itemIdArr.filter((function(id){return id!=orderitemId})),$(".order-list").data("itemidarr",itemIdArr.join(","))}$.ajax({url:"${APP_PATH}/MlfrontOrder/delOrderItem",data:JSON.stringify(reqData),type:"post",dataType:"json",contentType:"application/json",success:function(data){el.remove(),$(".order-item").length||goToCartList(),callback&&callback(orderitemId),resetOrderListData(),deleteProductSuccessModal()},error:function(){el.find(".product-num").val(targetData.cartitemProductNumber),deleteProductFailModal()}})}function orderSaveAddress(reqData,callback){$.ajax({url:"${APP_PATH}/MlfrontAddress/save",type:"post",dataType:"json",data:JSON.stringify(reqData),contentType:"application/json",success:function(data){100==data.code?callback&&callback(data.extend.mlfrontAddress):sysModalTip()},error:function(){sysModalTip()}})}function orderPay(reqData,callback){$.ajax({url:"${APP_PATH}/MlfrontOrder/orderToPayInfo",data:JSON.stringify(reqData),type:"post",dataType:"json",contentType:"application/json",success:function(data){100==data.code?callback&&callback(data.extend):sysModalTip()},error:function(err){sysModalTip()}})}function countryCombineWithProvince(){getProvinceData({addressCountry:$("#addressCountry").find("option:checked").data("value")},(function(data){var money=data.areafreightMoney,provinceList=data.mlPaypalStateprovinceList;$(".order-address-shipping").data("shipping",money).find(".value").text("$"+money),provinceList&&provinceList.length>0?(renderProvince(provinceList),$("#addressProvince").data("status",!1),hasProvince=!0,$("#addressProvince").parents(".form-group").removeClass("hide"),$("#addressCountry").parents(".form-group").css("width","")):($("#addressProvince").val("").data("status",!0),hasProvince=!1,$("#addressProvince").parents(".form-group").addClass("hide"),$("#addressCountry").parents(".form-group").css("width","100%"))}))}

function calOrderList(){var o=$(".order-coupon-group").data("coupon"),e={prototal:0,subtotal:0,shipping:$(".order-address-shipping").data("shipping")||0,coupon:0},n=($(".order-list").data("productidarr").split(","),[]),p=$("#addressEmail").val().trim();if($(".order-item").each(function(o,n){var p=$(n).data("orderitem"),c=parseFloat((parseFloat(accuracyCal((p.orderitemProductOriginalprice||0)+parseFloat(p.orderitemPskuMoneystr||0),p.orderitemProductAccoff||100))*p.orderitemPskuNumber).toFixed(2));e.prototal+=c}),o&&!o.mlbackCouponOne&&(e.coupon=0,$(".order-coupon-tip").html("<p>"+o.resMsg+"</p>")),o&&o.mlbackCouponOne){function c(n){return!(o.mlbackCouponOne.couponPriceBaseline&&!(o.mlbackCouponOne.couponPriceBaseline&&n>=parseFloat(o.mlbackCouponOne.couponPriceBaseline)))||(e.coupon=0,$(".order-coupon-tip").html('<p>The minimum usage price of this coupon is + <i style="color: #f00">$'+o.mlbackCouponOne.couponPriceBaseline+"<i></p>"),!1)}function r(n){""+o.mlbackCouponOne.couponType=="0"&&(e.coupon=parseFloat(o.mlbackCouponOne.couponPrice)),""+o.mlbackCouponOne.couponType=="1"&&(e.coupon=parseFloat(accuracyCal(n,o.mlbackCouponOne.couponPriceoff||100))),$(".order-coupon-tip").html('<p><i style="color: #f00">'+o.mlbackCouponOne.couponCode+"</i> used successful ! </p>")}function u(o){var e=0;return $(".order-item").each(function(p,c){var r=$(c).data("orderitem"),u=parseFloat((parseFloat(accuracyCal((r.orderitemProductOriginalprice||0)+parseFloat(r.orderitemPskuMoneystr||0),r.orderitemProductAccoff||100))*r.orderitemPskuNumber).toFixed(2));"all"==o&&(e+=u),"products"==o&&n.indexOf(""+r.orderitemPid)>-1&&(e+=u),"collection"==o&&n.indexOf(""+r.orderitemPid)>-1&&(e+=u),"except"==o&&n.indexOf(""+r.orderitemPid)<0&&(e+=u)}),e}function t(o){var e=u(o);e?c(e)&&r(e):$(".order-coupon-tip").html('<p><i style="color: #f00">This coupon does not apply to the currently purchased product! </p>')}function i(){""+o.mlbackCouponOne.couponProductonlyType!="0"&&o.mlbackCouponOne.couponProductonlyType||t("all"),""+o.mlbackCouponOne.couponProductonlyType=="1"&&(n=o.mlbackCouponOne.couponProductonlyPidstr&&o.mlbackCouponOne.couponProductonlyPidstr.split(","),t("products")),""+o.mlbackCouponOne.couponProductonlyType=="2"&&(n=o.mlbackCouponOne.couponProsFromApplyCateidstr&&o.mlbackCouponOne.couponProsFromApplyCateidstr.split(","),t("collection")),""+o.mlbackCouponOne.couponProductonlyType=="3"&&(n=o.mlbackCouponOne.couponAllExceptPidstr&&o.mlbackCouponOne.couponAllExceptPidstr.split(","),t("except"))}""+o.mlbackCouponOne.couponCodeUniqueEmailIF=="1"?p?o.mlbackCouponOne.couponCodeUniqueEmail&&o.mlbackCouponOne.couponCodeUniqueEmail.indexOf(p)>-1?i():(e.coupon=0,$(".order-coupon-tip").html("<p>This coupon is only applicable to designated users!</p>")):(mlModalTip("This is an exclusive coupon, you need to complete the address information!"),$(".order-coupon-tip").html(""),$("html").animate({scrollTop:0},500)):i()}showFreeGift(e.prototal);return e.subtotal=e.prototal+e.shipping-e.coupon,e.coupon<=0&&$(".order-coupon-group").data("coupon",""),e}

function resetOrderCal(){var calOrder=calOrderList();$(".order-cal-prototal").text("$"+calOrder.prototal.toFixed(2)),$(".order-cal-shipping").text("$"+calOrder.shipping.toFixed(2)),$(".order-cal-coupon").text("-$"+calOrder.coupon.toFixed(2)),$(".order-cal-subtotal").text("$"+calOrder.subtotal.toFixed(2)).data("price",calOrder.subtotal.toFixed(2));$('#pp-message-price').attr("data-pp-amount",$('.order-cal-subtotal').html().replace('$',''))}function renderCountry(){for(var n="",a=[{name:"United States",nickname:"US"},{name:"United Kingdom",nickname:"GB"},{name:"Canada",nickname:"CA"},{name:"Nigeria",nickname:"NG"},{name:"Australia",nickname:"AU"},{name:"South Africa",nickname:"ZA"},{name:"Germany",nickname:"DE"},{name:"Kenya",nickname:"KE"},{name:"Spain",nickname:"ES"},{name:"United Arab Emirates",nickname:"AE"},{name:"France",nickname:"FR"},{name:"--------------------",nickname:null},{name:"Afghanistan",nickname:"AF"},{name:"Åland Islands",nickname:"AX"},{name:"Albania",nickname:"AL"},{name:"Algeria",nickname:"DZ"},{name:"American Samoa",nickname:"AS"},{name:"Andorra",nickname:"AD"},{name:"Angola",nickname:"AO"},{name:"Anguilla",nickname:"AI"},{name:"Antarctica",nickname:"AQ"},{name:"Antigua and Barbuda",nickname:"AG"},{name:"Argentina",nickname:"AR"},{name:"Armenia",nickname:"AM"},{name:"Aruba",nickname:"AW"},{name:"Australia",nickname:"AU"},{name:"Austria",nickname:"AT"},{name:"Azerbaijan",nickname:"AZ"},{name:"Bahamas",nickname:"BS"},{name:"Bahrain",nickname:"BH"},{name:"Bangladesh",nickname:"BD"},{name:"Barbados",nickname:"BB"},{name:"Belarus",nickname:"BY"},{name:"Belgium",nickname:"BE"},{name:"Belize",nickname:"BZ"},{name:"Benin",nickname:"BJ"},{name:"Bermuda",nickname:"BM"},{name:"Bhutan",nickname:"BT"},{name:"Bolivia",nickname:"BO"},{name:"Bosnia and Herzegovina",nickname:"BA"},{name:"Botswana",nickname:"BW"},{name:"Bouvet Island",nickname:"BV"},{name:"Brazil",nickname:"BR"},{name:"British Indian Ocean Territory",nickname:"IO"},{name:"British Virgin Islands",nickname:"VG"},{name:"Brunei",nickname:"BN"},{name:"Bulgaria",nickname:"BG"},{name:"Burkina Faso",nickname:"BF"},{name:"Burundi",nickname:"BI"},{name:"Cambodia",nickname:"KH"},{name:"Canada",nickname:"CA"},{name:"Cameroon",nickname:"CM"},{name:"Cape Verde",nickname:"CV"},{name:"Cayman Islands",nickname:"KY"},{name:"Central African Republic",nickname:"CF"},{name:"Chad",nickname:"TD"},{name:"Chile",nickname:"CL"},{name:"China",nickname:"CN"},{name:"Christmas Island",nickname:"CX"},{name:"Cocos (Keeling) Islands",nickname:"CC"},{name:"Colombia",nickname:"CO"},{name:"Comoros",nickname:"KM"},{name:"Congo - Brazzaville",nickname:"CG"},{name:"Congo - Kinshasa",nickname:"CD"},{name:"Cook Islands",nickname:"CK"},{name:"Costa Rica",nickname:"CR"},{name:"Côte d’Ivoire",nickname:"CI"},{name:"Croatia",nickname:"HR"},{name:"Cuba",nickname:"CU"},{name:"Cyprus",nickname:"CY"},{name:"Czech Republic",nickname:"CZ"},{name:"Denmark",nickname:"DK"},{name:"Djibouti",nickname:"DJ"},{name:"Dominica",nickname:"DM"},{name:"Dominican Republic",nickname:"DO"},{name:"Ecuador",nickname:"EC"},{name:"Egypt",nickname:"EG"},{name:"El Salvador",nickname:"SV"},{name:"Equatorial Guinea",nickname:"GQ"},{name:"Eritrea",nickname:"ER"},{name:"Estonia",nickname:"EE"},{name:"Ethiopia",nickname:"ET"},{name:"Falkland Islands",nickname:"FK"},{name:"Faroe Islands",nickname:"FO"},{name:"France",nickname:"FR"},{name:"Fiji",nickname:"FJ"},{name:"Finland",nickname:"FI"},{name:"Gabon",nickname:"GA"},{name:"Gambia",nickname:"GM"},{name:"Georgia",nickname:"GE"},{name:"Germany",nickname:"DE"},{name:"Ghana",nickname:"GH"},{name:"Gibraltar",nickname:"GI"},{name:"Greece",nickname:"GR"},{name:"Greenland",nickname:"GL"},{name:"Grenada",nickname:"GD"},{name:"Guadeloupe",nickname:"GP"},{name:"Guam",nickname:"GU"},{name:"Guatemala",nickname:"GT"},{name:"Guernsey",nickname:"GG"},{name:"Guinea",nickname:"GN"},{name:"Guinea-Bissau",nickname:"GW"},{name:"Guyana",nickname:"GY"},{name:"Haiti",nickname:"HT"},{name:"Heard &amp; McDonald Islands",nickname:"HM"},{name:"Honduras",nickname:"HN"},{name:"Hong Kong SAR China",nickname:"HK"},{name:"Hungary",nickname:"HU"},{name:"Iceland",nickname:"IS"},{name:"India",nickname:"IN"},{name:"Indonesia",nickname:"ID"},{name:"Iran",nickname:"IR"},{name:"Iraq",nickname:"IQ"},{name:"Ireland",nickname:"IE"},{name:"Isle of Man",nickname:"IM"},{name:"Israel",nickname:"IL"},{name:"Italy",nickname:"IT"},{name:"Jamaica",nickname:"JM"},{name:"Japan",nickname:"JP"},{name:"Jersey",nickname:"JE"},{name:"Jordan",nickname:"JO"},{name:"Kazakhstan",nickname:"KZ"},{name:"Kenya",nickname:"KE"},{name:"Kiribati",nickname:"KI"},{name:"Kuwait",nickname:"KW"},{name:"Kyrgyzstan",nickname:"KG"},{name:"Laos",nickname:"LA"},{name:"Latvia",nickname:"LV"},{name:"Lebanon",nickname:"LB"},{name:"Lesotho",nickname:"LS"},{name:"Liberia",nickname:"LR"},{name:"Libya",nickname:"LY"},{name:"Liechtenstein",nickname:"LI"},{name:"Lithuania",nickname:"LT"},{name:"Luxembourg",nickname:"LU"},{name:"Macau SAR China",nickname:"MO"},{name:"Macedonia",nickname:"MK"},{name:"Madagascar",nickname:"MG"},{name:"Malawi",nickname:"MW"},{name:"Malaysia",nickname:"MY"},{name:"Maldives",nickname:"MV"},{name:"Mali",nickname:"ML"},{name:"Malta",nickname:"MT"},{name:"Marshall Islands",nickname:"MH"},{name:"Martinique",nickname:"MQ"},{name:"Mauritania",nickname:"MR"},{name:"Mauritius",nickname:"MU"},{name:"Mayotte",nickname:"YT"},{name:"Mexico",nickname:"MX"},{name:"Micronesia",nickname:"FM"},{name:"Moldova",nickname:"MD"},{name:"Monaco",nickname:"MC"},{name:"Mongolia",nickname:"MN"},{name:"Montenegro",nickname:"ME"},{name:"Montserrat",nickname:"MS"},{name:"Morocco",nickname:"MA"},{name:"Mozambique",nickname:"MZ"},{name:"Myanmar (Burma)",nickname:"MM"},{name:"Namibia",nickname:"NA"},{name:"Nauru",nickname:"NR"},{name:"Nepal",nickname:"NP"},{name:"Netherlands",nickname:"NL"},{name:"Netherlands Antilles",nickname:"AN"},{name:"New Caledonia",nickname:"NC"},{name:"New Zealand",nickname:"NZ"},{name:"Nicaragua",nickname:"NI"},{name:"Niger",nickname:"NE"},{name:"Nigeria",nickname:"NG"},{name:"Niue",nickname:"NU"},{name:"Norfolk Island",nickname:"NF"},{name:"Northern Mariana Islands",nickname:"MP"},{name:"North Korea",nickname:"KP"},{name:"Norway",nickname:"NO"},{name:"Oman",nickname:"OM"},{name:"Pakistan",nickname:"PK"},{name:"Palau",nickname:"PW"},{name:"Palestinian Territories",nickname:"PS"},{name:"Panama",nickname:"PA"},{name:"Papua New Guinea",nickname:"PG"},{name:"Paraguay",nickname:"PY"},{name:"Peru",nickname:"PE"},{name:"Philippines",nickname:"PH"},{name:"Pitcairn Islands",nickname:"PN"},{name:"Poland",nickname:"PL"},{name:"Portugal",nickname:"PT"},{name:"Puerto Rico",nickname:"PR"},{name:"Qatar",nickname:"QA"},{name:"Réunion",nickname:"RE"},{name:"Romania",nickname:"RO"},{name:"Russia",nickname:"RU"},{name:"Rwanda",nickname:"RW"},{name:"Saint Barthélemy",nickname:"BL"},{name:"Saint Helena",nickname:"SH"},{name:"Saint Kitts and Nevis",nickname:"KN"},{name:"Saint Lucia",nickname:"LC"},{name:"Saint Martin",nickname:"MF"},{name:"Saint Pierre and Miquelon",nickname:"PM"},{name:"Samoa",nickname:"WS"},{name:"San Marino",nickname:"SM"},{name:"São Tomé and Príncipe",nickname:"ST"},{name:"Saudi Arabia",nickname:"SA"},{name:"Senegal",nickname:"SN"},{name:"Serbia",nickname:"RS"},{name:"Seychelles",nickname:"SC"},{name:"Sierra Leone",nickname:"SL"},{name:"Singapore",nickname:"SG"},{name:"Slovakia",nickname:"SK"},{name:"Slovenia",nickname:"SI"},{name:"Solomon Islands",nickname:"SB"},{name:"Somalia",nickname:"SO"},{name:"South Africa",nickname:"ZA"},{name:"South Georgia &amp; South Sandwich Islands",nickname:"GS"},{name:"South Korea",nickname:"KR"},{name:"Spain",nickname:"ES"},{name:"Sri Lanka",nickname:"LK"},{name:"St. Vincent &amp; Grenadines",nickname:"VC"},{name:"Sudan",nickname:"SD"},{name:"Suriname",nickname:"SR"},{name:"Svalbard and Jan Mayen",nickname:"SJ"},{name:"Swaziland",nickname:"SZ"},{name:"Sweden",nickname:"SE"},{name:"Switzerland",nickname:"CH"},{name:"Syria",nickname:"SY"},{name:"Taiwan",nickname:"TW"},{name:"Tajikistan",nickname:"TJ"},{name:"Tanzania",nickname:"TZ"},{name:"Thailand",nickname:"TH"},{name:"Timor-Leste",nickname:"TL"},{name:"Togo",nickname:"TG"},{name:"Tokelau",nickname:"TK"},{name:"Tonga",nickname:"TO"},{name:"Trinidad and Tobago",nickname:"TT"},{name:"Tunisia",nickname:"TN"},{name:"Turkey",nickname:"TR"},{name:"Turkmenistan",nickname:"TM"},{name:"Turks and Caicos Islands",nickname:"TC"},{name:"Tuvalu",nickname:"TV"},{name:"Uganda",nickname:"UG"},{name:"Ukraine",nickname:"UA"},{name:"Uruguay",nickname:"UY"},{name:"United Arab Emirates",nickname:"AE"},{name:"United Kingdom",nickname:"GB"},{name:"United States",nickname:"US"},{name:"U.S. Outlying Islands",nickname:"UM"},{name:"U.S. Virgin Islands",nickname:"VI"},{name:"Uzbekistan",nickname:"UZ"},{name:"Vanuatu",nickname:"VU"},{name:"Vatican City",nickname:"VA"},{name:"Venezuela",nickname:"VE"},{name:"Vietnam",nickname:"VN"},{name:"Wallis and Futuna",nickname:"WF"},{name:"Western Sahara",nickname:"EH"},{name:"Yemen",nickname:"YE"},{name:"Zambia",nickname:"ZM"},{name:"Zimbabwe",nickname:"ZW"}],e=0,m=a.length;e<m;e++){var i=a[e].nickname;n+=null==i?'<option disabled=="disabled" value="'+a[e].name+'">'+a[e].name+"</option>":'<option data-value="'+a[e].nickname+'" value="'+a[e].name+'">'+a[e].name+"</option>"}$("#addressCountry").html(n)}function renderProvince(data){for(var htmlStr='<option value="state">State/Province</option>',defaultValue=$("#addressProvince").data("value"),i=0,len=data.length;i<len;i+=1)htmlStr+='<option value="'+data[i].stateprovinceName+'"'+(defaultValue==data[i].stateprovinceName?"selected":"")+">"+data[i].stateprovinceName+"</option>";$("#addressProvince").html(htmlStr)}function renderOrderList(data){var $orderList=$('<div class="order-list" />'),orderProductIdArr=[],orderItemIdArr=[],orderProductNumArr=[];data.forEach((function(item,idx){var orderSkuList="",optionArr=item.orderitemPskuIdnamestr.split(","),skuNameArr=item.orderitemPskuName.split(",");optionArr.forEach((function(item,idx){orderSkuList+='<div class="order-sku-list-item"><span class="name">'+item+' :</span><span class="value">'+skuNameArr[idx]+"</span></div>"})),orderProductIdArr.push(item.orderitemPid),orderItemIdArr.push(item.orderitemId),orderProductNumArr.push(item.orderitemPskuNumber);var productLink=item.orderitemPseo?"${APP_PATH}/"+item.orderitemPseo+".html":"javascript:;";$orderList.append($('<div class="order-item"><a href="'+productLink+'" class="order-img lazyload" data-src="'+item.orderitemProductMainimgurl+'"></a><div class="order-product"><a class="order-product-name" href="'+productLink+'">'+item.orderitemPname+'</a><div class="order-sku-list">'+orderSkuList+'</div><div class="order-product-num"><div class="order-product-price"><span class="product-define-price">$'+(item.orderitemProductOriginalprice+parseFloat(item.orderitemPskuMoneystr)||0).toFixed(2)+'</span><span class="product-now-price">$'+(item.orderitemProductOriginalprice&&item.orderitemProductAccoff?accuracyCal(item.orderitemProductOriginalprice+parseFloat(item.orderitemPskuMoneystr),item.orderitemProductAccoff):0)+'</span></div><span class="icon delete product-delete"></span><div class="product-qty"><span class="group-addon product-sub"><i class="icon sub"></i></span><input type="text" disabled class="product-num" value="'+item.orderitemPskuNumber+'" /><span class="group-addon product-add"><i class="icon plus"></i></span></div></div></div></div>').data("orderitem",item))})),$orderList.data("itemidarr",orderItemIdArr.join(",")).data("productidarr",orderProductIdArr.join(",")).data("itemnumarr",orderProductNumArr.join(","));var $cartReviewBox=$('<div class="cart-box"><div class="cart-box-title"><span class="order-sort">2</span>Checkout Review</div><div class="cart-box-body"></div></div>');$cartReviewBox.find(".cart-box-body").append($orderList),$(".checkout-order-list").append($cartReviewBox),new LazyLoad($orderList.find(".lazyload"),{root:null,rootMargin:"10px",threshold:0})}function renderOrderCoupons(){var $cartCouponBox=$('<div class="cart-box"><div class="cart-box-title"><span class="order-sort">3</span>DISCOUNT CODES</div><div class="cart-box-body"><div class="product-coupons hide"></div><div class="order-coupons"><div class="order-coupon-list"></div><div class="order-coupon-group"><input type="text" placeholder="Please enter code" /><button id="order-check-coupon" class="btn btn-pink">APPLY</button></div><div class="order-coupon-tip"></div></div></div></div>');$(".checkout-coupons").html("").append($cartCouponBox),getCouponAreaData(renderCouponAreaData)}function renderOrderBuyerMsg(){var $cartBuyerMsgBox=$('<div class="cart-box"><div class="cart-box-title"><span class="order-sort">4</span>ADDITIONAL INFORMATION</div><div class="cart-box-body"><div class="order-buyer-msg"><textarea rows="2" placeholder="Any Request,Notes Here."></textarea></div></div></div>');$(".checkout-buy-msg").append($cartBuyerMsgBox)}function rednerOrderCal(){var a=calOrderList(),s=$('<div class="cart-box"><div class="cart-box-body"><div class="order-cal"><div class="order-cal-item"><span class="name">prototal</span><span class="value order-cal-prototal">$'+a.prototal.toFixed(2)+'</span></div><div class="order-cal-item"><span class="name">coupon</span><span class="value order-cal-coupon">-$'+a.coupon.toFixed(2)+'</span></div><div class="order-cal-item"><span class="name">shipping</span><span class="value order-cal-shipping">$'+a.shipping.toFixed(2)+'</span></div><div class="order-cal-item"><span class="name">subtotal</span><span class="value order-cal-subtotal" data-price="'+a.subtotal.toFixed(2)+'">$'+a.subtotal.toFixed(2)+'</span></div><div id="pp-message-price" style="margin-top: 1rem;" data-pp-message data-pp-placement="product" data-pp-amount="" data-pp-style-layout="text" data-pp-buyerCountry="US"></div><div id="paypal-button-container-2" style="position: relative; z-index: 1; text-align: center;"><p class="paypal-loading">Paypal loading...</p></div></div></div></div>');$(".checkout-order-cal").append(s),$("#pp-message-price").attr("data-pp-amount",$(".order-cal-subtotal").html().replace("$",""))}function checkInputAdressInfo(){for(var flag=!0,idx=0,len=$(".address-box .form-group").length;idx<len;idx+=1){var item=$(".address-box .form-group")[idx];if(!$(item).find(".form-control").data("status")&&(!$(item).find(".form-control").val()||"state"==$(item).find(".form-control").val())){mlModalTip('Address information <i style="color: #f00">'+$(item).find(".form-label").text()+"</i> can't be empty !"),$(item).find(".form-control").focus(),flag=!1;break}}return flag}function checkCouponCode(reqData,callback){$.ajax({url:"${APP_PATH}/MlbackCoupon/getOneMlbackCouponDetailByCode",data:JSON.stringify(reqData),type:"post",dataType:"json",contentType:"application/json",success:function(data){100==data.code?callback&&callback(data.extend):sysModalTip()},error:function(err){sysModalTip()}})}function getOrderAddress(){var addressData={};return $(".address-box .form-control").each((function(idx,item){"addressCountry"==item.name&&(addressData.addressCountryCode=$(item).find("option:checked").data("value")),addressData[item.name]=(item.value||"").trim()})),addressData}function initOrderAddress(data){$(".address-box .form-control").each((function(idx,item){"addressProvince"==item.name&&$(item).data("value",data[item.name]),$(item).val(data[item.name])})),isBackFill=!0}function getOrderPayInfo(){var couponData=$(".order-coupon-group").data("coupon")||{};return{orderId:$(".order-list").data("orderid")||null,orderOrderitemidstr:$(".order-list").data("itemidarr"),orderCouponId:couponData.mlbackCouponOne&&couponData.mlbackCouponOne.couponId||"",orderCouponCode:couponData.mlbackCouponOne&&couponData.mlbackCouponOne.couponCode||"",orderPayPlate:$('input[name="payment"]:checked').val(),orderProNumStr:$(".order-list").data("itemnumarr"),orderBuyMess:$(".order-buyer-msg textarea").val(),addressinfoId:$("#addressId").val(),orderCreatetime:$(".order-list").data("productidarr"),orderMotifytime:checkoutviewId}}function initialOrder(){renderCountry();var $paypalTip=$(".paypal-error-tip");!$paypalTip.hasClass("hide")&&$paypalTip.addClass("hide"),$("#addressEmail, #addressCountry, #addressProvince, #addressCity, #addressPost").on("foucs",(function(){!$paypalTip.hasClass("hide")&&$paypalTip.addClass("hide")})),getUserInfo((function(data){var addressData=data.mlfrontAddressOne;addressData&&initOrderAddress(addressData),$(".order-address-shipping").data("shipping",data.areafreightMoney).find(".value","$"+data.areafreightMoney),countryCombineWithProvince()})),getProductOrderList((function(data){var orderListData=data.mlfrontOrderItemList;if(!orderListData.length)return mlModalTip("Don't have to pay for goods, please to add items in the shopping cart, and then to pay !"),void goToCartList();renderOrderList(orderListData),renderFreeGift(),$(".order-list").data("orderid",data.orderId)})),renderOrderCoupons(),renderOrderBuyerMsg(),rednerOrderCal(),isBackFill&&collectShippingAddress&&collectShippingAddress();}var hasProvince=!0;setTimeout(initialOrder,0),$("#addressCountry").on("change",(function(){countryCombineWithProvince(),resetOrderCal()})),$(document.body).on("click",".product-add",(function(){productAdd($(this),(function(el,num){updateOrderNum(el,num,resetOrderCal)}))})),$(document.body).on("click",".product-sub",(function(){productSub($(this),(function(el,num){updateOrderNum(el,num,resetOrderCal)}))})),$(document.body).on("click",".product-delete",function(){deleteOrderProduct($(this).parents(".order-item"),function(r){var t=$(".order-list").data("productidarr").split(","),i=$(".order-list").data("itemnumarr").split(","),d=$(".order-list").data("itemidarr").split(",");d.forEach(function(e,a){e==r&&(t.splice(a,1),d.splice(a,1),i.splice(a,1))}),$(".order-list").data("productidarr",t.join(",")),$(".order-list").data("itemidarr",d.join(",")),$(".order-list").data("itemnumarr",i.join(",")),resetOrderCal()})}),$(document.body).on("click","#order-check-coupon",(function(){var couponCode=$(".order-coupon-group input").val().trim();couponCode?checkCouponCode({couponCreatetime:$(".order-list").data("productidarr"),couponCode:couponCode},(function(data){$(".order-coupon-group").data("coupon",data),resetOrderCal()})):mlModalTip("Please enter a valid coupon code !")})),$(document.body).on("click","#pay-now",(function(){checkInputAdressInfo()&&orderSaveAddress(getOrderAddress(),(function(data){$("#addressId").val(data.addressId);var productIdArr=$(".order-list").data("productidarr")?$(".order-list").data("productidarr").split(","):[],orderMoney=$(".order-cal-subtotal").data("price");fbq("track","AddPaymentInfo",{content_ids:productIdArr,content_type:"product",value:orderMoney,currency:"USD"}),payLoading(),orderPay(getOrderPayInfo(),goToPay)}))})),$("#addressEmail").on("change",function(){$(".order-coupons").find("input").val(""),$(".order-coupons").find(".order-coupon-tip").html(""),$(".order-coupon-group").data("coupon",""),resetOrderCal()});</script>
<script>$(".website-policy-item").on("click",function(e){$(this);var t,a='<iframe src="'+e.target.href+'"><iframe>';e.preventDefault(),t=createModal({header:{html:"<p>"+$(this).data("title")+"</p>"},body:{html:a}}),t.addClass("policy-modal")});$(document.body).on("change",'input[type="radio"][name="payment"]',function(){$('input[name="payment"]:checked').val();$(".paypal-box").addClass("hide"),$(this).parents(".order-payment-item").find(".paypal-box").removeClass("hide")});</script>

<!-- paypal button -->
<script>function addPaypalScript(){var a=document.createElement("script");a.src="https://www.paypal.com/sdk/js?client-id="+ml.paypal_clientid+"&components=messages,buttons",document.body.appendChild(a),a.onload=function(){paypalPayment()},a.onerror=function(){mlModalTip("paypal loading failed, Please refresh the page later and try again...")}}function checkInputAdressInfoForPaypalButton(){for(var a=!0,e=0,n=$(".address-box .form-group").length;e<n;e+=1){var t=$(".address-box .form-group")[e];if(!$(t).find(".form-control").data("status")&&(!$(t).find(".form-control").val()||"state"==$(t).find(".form-control").val())){a=!1;break}}return a}function paySuccessfulLoading(){var a=parseInt($(".modal").css("z-index"),10)+$(".modal").length+1||99999999999,e=$('<div class="pay-loading" style="z-index: '+a+'"><div style="width:100%;height:100%;background-repeat:no-repeat;background-position:center;background-image:url(${APP_PATH}/static/pc/img/paypal-success.gif)"></div></div>');$(document.body).append(e),addFixed()}function paypalPayment(){paypal.Buttons({env:"production",style:{layout:"vertical",color:"gold",shape:"rect",size:"medium",label:"paypal"},commit:!0,onInit:function(a,e){checkInputAdressInfoForPaypalButton()?e.enable():e.disable(),$(".paypal-loading").addClass("hide"),paypalAct=e},onClick:function(a){if(checkInputAdressInfo()){var e=getOrderAddress();payLoading(),$.ajax({url:"${APP_PATH}/MlfrontAddress/save",type:"post",dataType:"json",data:JSON.stringify(e),contentType:"application/json",async:!1,success:function(a){if(100==a.code){var e=a.extend.mlfrontAddress,n=$(".order-list").data("productidarr")?$(".order-list").data("productidarr").split(","):[],t=$(".order-cal-subtotal").data("price");$("#addressId").val(e.addressId),fbq("track","AddPaymentInfo",{content_ids:n,content_type:"product",value:t,currency:"USD"})}else hidePayLoading(),sysModalTip()},error:function(){hidePayLoading(),sysModalTip()}})}},createOrder:function(){var a,e=getOrderPayInfo();return $.ajax({url:"${APP_PATH}/MlfrontOrderSuper/orderToPayInfo",data:JSON.stringify(e),type:"post",dataType:"json",contentType:"application/json",async:!1,success:function(e){if(100==e.code){var n=JSON.parse(e.extend.data);n.links&&n.links.forEach(function(e){"approval_url"==e.rel&&(a=e.href.match(/EC-\w+/)[0])})}if(200==e.code)createModal({header:{html:"<p>Paypal Error tip!</p>"},body:{html:"<p>"+e.extend.data+"</p>"}})},error:function(a){sysModalTip()},complete:function(){hidePayLoading()}}),a},onApprove:function(a){payLoading(),window.location.href="${APP_PATH}/paypal/msuccess?paymentId="+a.paymentID+"&PayerID="+a.payerID},onCancel:function(){hidePayLoading()}}).render("#paypal-button-container-2")}var paypalAct;addPaypalScript(),$(".address-box .form-control").on("change",function(){var a=checkInputAdressInfoForPaypalButton();a?paypalAct&&paypalAct.enable():paypalAct&&paypalAct.disable()});</script>