<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<% pageContext.setAttribute("APP_PATH", request.getContextPath()); %>
<script>function getProductOrderList(n){$.ajax({url:"${APP_PATH}/MlfrontOrder/getNowOrderDetail",type:"get",async:!1,cache:!1,success:function(a){100==a.code&&n&&n(a.extend)}})}function getProvinceData(n,a){$.ajax({url:"${APP_PATH}/MlfrontAddress/getAreafreightMoney",data:JSON.stringify(n),async:!1,type:"post",dataType:"json",contentType:"application/json",async:!1,success:function(n){100==n.code&&a&&a(n.extend)}})}function getUserInfo(n){$.ajax({url:"${APP_PATH}/MlfrontAddress/getOneMlfrontAddressDetailByUinfo",type:"post",dataType:"json",async:!1,success:function(a){n&&n(a.extend)}})}function updateOrderNum(n,a,e){var i=n.parents(".order-item").data("orderitem")||null,r={orderitemId:parseInt(i.orderitemId),orderitemPskuNumber:a};$.ajax({url:"${APP_PATH}/MlfrontOrder/updateOrderItemNum",data:JSON.stringify(r),type:"post",dataType:"json",contentType:"application/json",success:function(o){if(100==o.code){var t=$(".order-list").data("itemnumarr").split(","),c=$(".order-list").data("itemidarr").split(",");c.forEach(function(n,e){""+n==""+r.orderitemId&&(t[e]=a)}),$(".order-list").data("itemnumarr",t.join(",")),updateProructNumberInCart(),i.orderitemPskuNumber=a,n.parents(".order-item").data("orderitem",i),e&&e(),updateProductNumSuccessModal()}else n.find(".product-num").val(i.orderitemPskuNumber),updateProductNumFailModal()},error:function(){n.find(".product-num").val(i.cartitemProductNumber),updateProductNumFailModal()}})}function deleteOrderProduct(n,a){function e(){var n=$(".order-list").data("itemidarr").split(",");n=n.filter(function(n){return n!=r}),$(".order-list").data("itemidarr",n.join(","))}var i=n.data("orderitem")||null,r=parseInt(i.orderitemId),o={orderitemId:r};$.ajax({url:"${APP_PATH}/MlfrontOrder/delOrderItem",data:JSON.stringify(o),type:"post",dataType:"json",contentType:"application/json",success:function(i){n.remove(),$(".order-item").length||goToCartList(),a&&a(r),e(),deleteProductSuccessModal()},error:function(){n.find(".product-num").val(i.cartitemProductNumber),deleteProductFailModal()}})}function orderSaveAddress(n,a){$.ajax({url:"${APP_PATH}/MlfrontAddress/save",type:"post",dataType:"json",data:JSON.stringify(n),contentType:"application/json",success:function(n){100==n.code?a&&a(n.extend.mlfrontAddress):sysModalTip()},error:function(){sysModalTip()}})}function orderPay(n,a){$.ajax({url:"${APP_PATH}/MlfrontOrder/orderToPayInfo",data:JSON.stringify(n),type:"post",dataType:"json",contentType:"application/json",success:function(n){100==n.code?a&&a(n.extend):sysModalTip()},error:function(n){sysModalTip()}})}function countryCombineWithProvince(){getProvinceData({addressCountry:$("#addressCountry").find("option:checked").data("value")},function(n){var a=n.areafreightMoney,e=n.mlPaypalStateprovinceList;$(".order-address-shipping").data("shipping",a).find(".value").text("$"+a),e&&e.length>0?(renderProvince(e),$("#addressProvince").data("status",!1),hasProvince=!0,$("#addressProvince").parents(".form-group").removeClass("hide"),$("#addressCountry").parents(".form-group").css("width","")):($("#addressProvince").val("").data("status",!0),hasProvince=!1,$("#addressProvince").parents(".form-group").addClass("hide"),$("#addressCountry").parents(".form-group").css("width","100%"))})}function calOrderList(){var n=$(".order-coupon-group").data("coupon"),a={prototal:0,subtotal:0,shipping:$(".order-address-shipping").data("shipping")||0,coupon:0},e=($(".order-list").data("productidarr").split(","),[]),i=$("#addressEmail").val().trim();if($(".order-item").each(function(n,e){var i=$(e).data("orderitem"),r=parseFloat((parseFloat(accuracyCal((i.orderitemProductOriginalprice||0)+parseFloat(i.orderitemPskuMoneystr||0),i.orderitemProductAccoff||100))*i.orderitemPskuNumber).toFixed(2));a.prototal+=r}),n&&!n.mlbackCouponOne&&(a.coupon=0,$(".order-coupon-tip").html("<p>"+n.resMsg+"</p>")),n&&n.mlbackCouponOne){function r(e){return!(n.mlbackCouponOne.couponPriceBaseline&&!(n.mlbackCouponOne.couponPriceBaseline&&e>=parseFloat(n.mlbackCouponOne.couponPriceBaseline)))||(a.coupon=0,$(".order-coupon-tip").html('<p>The minimum usage price of this coupon is + <i style="color: #f00">$'+n.mlbackCouponOne.couponPriceBaseline+"<i></p>"),!1)}function o(e){""+n.mlbackCouponOne.couponType=="0"&&(a.coupon=parseFloat(n.mlbackCouponOne.couponPrice)),""+n.mlbackCouponOne.couponType=="1"&&(a.coupon=parseFloat(accuracyCal(e,n.mlbackCouponOne.couponPriceoff||100))),$(".order-coupon-tip").html('<p><i style="color: #f00">'+n.mlbackCouponOne.couponCode+"</i> used successful ! </p>")}function t(n){var a=0;return $(".order-item").each(function(i,r){var o=$(r).data("orderitem"),t=parseFloat((parseFloat(accuracyCal((o.orderitemProductOriginalprice||0)+parseFloat(o.orderitemPskuMoneystr||0),o.orderitemProductAccoff||100))*o.orderitemPskuNumber).toFixed(2));"all"==n&&(a+=t),"products"==n&&e.indexOf(""+o.orderitemPid)>-1&&(a+=t),"collection"==n&&e.indexOf(""+o.orderitemPid)>-1&&(a+=t),"except"==n&&e.indexOf(""+o.orderitemPid)<0&&(a+=t)}),a}function c(n){var a=t(n);a?r(a)&&o(a):$(".order-coupon-tip").html('<p><i style="color: #f00">This coupon does not apply to the currently purchased product! </p>')}function d(){""+n.mlbackCouponOne.couponProductonlyType!="0"&&n.mlbackCouponOne.couponProductonlyType||c("all"),""+n.mlbackCouponOne.couponProductonlyType=="1"&&(e=n.mlbackCouponOne.couponProductonlyPidstr&&n.mlbackCouponOne.couponProductonlyPidstr.split(","),c("products")),""+n.mlbackCouponOne.couponProductonlyType=="2"&&(e=n.mlbackCouponOne.couponProsFromApplyCateidstr&&n.mlbackCouponOne.couponProsFromApplyCateidstr.split(","),c("collection")),""+n.mlbackCouponOne.couponProductonlyType=="3"&&(e=n.mlbackCouponOne.couponAllExceptPidstr&&n.mlbackCouponOne.couponAllExceptPidstr.split(","),c("except"))}""+n.mlbackCouponOne.couponCodeUniqueEmailIF=="1"?i?n.mlbackCouponOne.couponCodeUniqueEmail&&n.mlbackCouponOne.couponCodeUniqueEmail.indexOf(i)>-1?d():(a.coupon=0,$(".order-coupon-tip").html("<p>This coupon is only applicable to designated users!</p>")):(mlModalTip("This is an exclusive coupon, you need to complete the address information!"),$(".order-coupon-tip").html(""),$("html").animate({scrollTop:0},500)):d()}return a.subtotal=a.prototal+a.shipping-a.coupon,a.coupon<=0&&$(".order-coupon-group").data("coupon",""),showFreeGift(a.prototal),a}function resetOrderCal(){var n=calOrderList();$(".order-cal-prototal").text("$"+n.prototal.toFixed(2)),$(".order-cal-shipping").text("$"+n.shipping.toFixed(2)),$(".order-cal-coupon").text("-$"+n.coupon.toFixed(2)),$(".order-cal-subtotal").text("$"+n.subtotal.toFixed(2)).data("price",n.subtotal.toFixed(2))}function renderCountry(){for(var n="",a=[{name:"United States",nickname:"US"},{name:"United Kingdom",nickname:"GB"},{name:"Canada",nickname:"CA"},{name:"Nigeria",nickname:"NG"},{name:"Australia",nickname:"AU"},{name:"South Africa",nickname:"ZA"},{name:"Germany",nickname:"DE"},{name:"Kenya",nickname:"KE"},{name:"Spain",nickname:"ES"},{name:"United Arab Emirates",nickname:"AE"},{name:"France",nickname:"FR"},{name:"--------------------",nickname:null},{name:"Afghanistan",nickname:"AF"},{name:"Åland Islands",nickname:"AX"},{name:"Albania",nickname:"AL"},{name:"Algeria",nickname:"DZ"},{name:"American Samoa",nickname:"AS"},{name:"Andorra",nickname:"AD"},{name:"Angola",nickname:"AO"},{name:"Anguilla",nickname:"AI"},{name:"Antarctica",nickname:"AQ"},{name:"Antigua and Barbuda",nickname:"AG"},{name:"Argentina",nickname:"AR"},{name:"Armenia",nickname:"AM"},{name:"Aruba",nickname:"AW"},{name:"Australia",nickname:"AU"},{name:"Austria",nickname:"AT"},{name:"Azerbaijan",nickname:"AZ"},{name:"Bahamas",nickname:"BS"},{name:"Bahrain",nickname:"BH"},{name:"Bangladesh",nickname:"BD"},{name:"Barbados",nickname:"BB"},{name:"Belarus",nickname:"BY"},{name:"Belgium",nickname:"BE"},{name:"Belize",nickname:"BZ"},{name:"Benin",nickname:"BJ"},{name:"Bermuda",nickname:"BM"},{name:"Bhutan",nickname:"BT"},{name:"Bolivia",nickname:"BO"},{name:"Bosnia and Herzegovina",nickname:"BA"},{name:"Botswana",nickname:"BW"},{name:"Bouvet Island",nickname:"BV"},{name:"Brazil",nickname:"BR"},{name:"British Indian Ocean Territory",nickname:"IO"},{name:"British Virgin Islands",nickname:"VG"},{name:"Brunei",nickname:"BN"},{name:"Bulgaria",nickname:"BG"},{name:"Burkina Faso",nickname:"BF"},{name:"Burundi",nickname:"BI"},{name:"Cambodia",nickname:"KH"},{name:"Canada",nickname:"CA"},{name:"Cameroon",nickname:"CM"},{name:"Cape Verde",nickname:"CV"},{name:"Cayman Islands",nickname:"KY"},{name:"Central African Republic",nickname:"CF"},{name:"Chad",nickname:"TD"},{name:"Chile",nickname:"CL"},{name:"China",nickname:"CN"},{name:"Christmas Island",nickname:"CX"},{name:"Cocos (Keeling) Islands",nickname:"CC"},{name:"Colombia",nickname:"CO"},{name:"Comoros",nickname:"KM"},{name:"Congo - Brazzaville",nickname:"CG"},{name:"Congo - Kinshasa",nickname:"CD"},{name:"Cook Islands",nickname:"CK"},{name:"Costa Rica",nickname:"CR"},{name:"Côte d’Ivoire",nickname:"CI"},{name:"Croatia",nickname:"HR"},{name:"Cuba",nickname:"CU"},{name:"Cyprus",nickname:"CY"},{name:"Czech Republic",nickname:"CZ"},{name:"Denmark",nickname:"DK"},{name:"Djibouti",nickname:"DJ"},{name:"Dominica",nickname:"DM"},{name:"Dominican Republic",nickname:"DO"},{name:"Ecuador",nickname:"EC"},{name:"Egypt",nickname:"EG"},{name:"El Salvador",nickname:"SV"},{name:"Equatorial Guinea",nickname:"GQ"},{name:"Eritrea",nickname:"ER"},{name:"Estonia",nickname:"EE"},{name:"Ethiopia",nickname:"ET"},{name:"Falkland Islands",nickname:"FK"},{name:"Faroe Islands",nickname:"FO"},{name:"France",nickname:"FR"},{name:"Fiji",nickname:"FJ"},{name:"Finland",nickname:"FI"},{name:"Gabon",nickname:"GA"},{name:"Gambia",nickname:"GM"},{name:"Georgia",nickname:"GE"},{name:"Germany",nickname:"DE"},{name:"Ghana",nickname:"GH"},{name:"Gibraltar",nickname:"GI"},{name:"Greece",nickname:"GR"},{name:"Greenland",nickname:"GL"},{name:"Grenada",nickname:"GD"},{name:"Guadeloupe",nickname:"GP"},{name:"Guam",nickname:"GU"},{name:"Guatemala",nickname:"GT"},{name:"Guernsey",nickname:"GG"},{name:"Guinea",nickname:"GN"},{name:"Guinea-Bissau",nickname:"GW"},{name:"Guyana",nickname:"GY"},{name:"Haiti",nickname:"HT"},{name:"Heard &amp; McDonald Islands",nickname:"HM"},{name:"Honduras",nickname:"HN"},{name:"Hong Kong SAR China",nickname:"HK"},{name:"Hungary",nickname:"HU"},{name:"Iceland",nickname:"IS"},{name:"India",nickname:"IN"},{name:"Indonesia",nickname:"ID"},{name:"Iran",nickname:"IR"},{name:"Iraq",nickname:"IQ"},{name:"Ireland",nickname:"IE"},{name:"Isle of Man",nickname:"IM"},{name:"Israel",nickname:"IL"},{name:"Italy",nickname:"IT"},{name:"Jamaica",nickname:"JM"},{name:"Japan",nickname:"JP"},{name:"Jersey",nickname:"JE"},{name:"Jordan",nickname:"JO"},{name:"Kazakhstan",nickname:"KZ"},{name:"Kenya",nickname:"KE"},{name:"Kiribati",nickname:"KI"},{name:"Kuwait",nickname:"KW"},{name:"Kyrgyzstan",nickname:"KG"},{name:"Laos",nickname:"LA"},{name:"Latvia",nickname:"LV"},{name:"Lebanon",nickname:"LB"},{name:"Lesotho",nickname:"LS"},{name:"Liberia",nickname:"LR"},{name:"Libya",nickname:"LY"},{name:"Liechtenstein",nickname:"LI"},{name:"Lithuania",nickname:"LT"},{name:"Luxembourg",nickname:"LU"},{name:"Macau SAR China",nickname:"MO"},{name:"Macedonia",nickname:"MK"},{name:"Madagascar",nickname:"MG"},{name:"Malawi",nickname:"MW"},{name:"Malaysia",nickname:"MY"},{name:"Maldives",nickname:"MV"},{name:"Mali",nickname:"ML"},{name:"Malta",nickname:"MT"},{name:"Marshall Islands",nickname:"MH"},{name:"Martinique",nickname:"MQ"},{name:"Mauritania",nickname:"MR"},{name:"Mauritius",nickname:"MU"},{name:"Mayotte",nickname:"YT"},{name:"Mexico",nickname:"MX"},{name:"Micronesia",nickname:"FM"},{name:"Moldova",nickname:"MD"},{name:"Monaco",nickname:"MC"},{name:"Mongolia",nickname:"MN"},{name:"Montenegro",nickname:"ME"},{name:"Montserrat",nickname:"MS"},{name:"Morocco",nickname:"MA"},{name:"Mozambique",nickname:"MZ"},{name:"Myanmar (Burma)",nickname:"MM"},{name:"Namibia",nickname:"NA"},{name:"Nauru",nickname:"NR"},{name:"Nepal",nickname:"NP"},{name:"Netherlands",nickname:"NL"},{name:"Netherlands Antilles",nickname:"AN"},{name:"New Caledonia",nickname:"NC"},{name:"New Zealand",nickname:"NZ"},{name:"Nicaragua",nickname:"NI"},{name:"Niger",nickname:"NE"},{name:"Nigeria",nickname:"NG"},{name:"Niue",nickname:"NU"},{name:"Norfolk Island",nickname:"NF"},{name:"Northern Mariana Islands",nickname:"MP"},{name:"North Korea",nickname:"KP"},{name:"Norway",nickname:"NO"},{name:"Oman",nickname:"OM"},{name:"Pakistan",nickname:"PK"},{name:"Palau",nickname:"PW"},{name:"Palestinian Territories",nickname:"PS"},{name:"Panama",nickname:"PA"},{name:"Papua New Guinea",nickname:"PG"},{name:"Paraguay",nickname:"PY"},{name:"Peru",nickname:"PE"},{name:"Philippines",nickname:"PH"},{name:"Pitcairn Islands",nickname:"PN"},{name:"Poland",nickname:"PL"},{name:"Portugal",nickname:"PT"},{name:"Puerto Rico",nickname:"PR"},{name:"Qatar",nickname:"QA"},{name:"Réunion",nickname:"RE"},{name:"Romania",nickname:"RO"},{name:"Russia",nickname:"RU"},{name:"Rwanda",nickname:"RW"},{name:"Saint Barthélemy",nickname:"BL"},{name:"Saint Helena",nickname:"SH"},{name:"Saint Kitts and Nevis",nickname:"KN"},{name:"Saint Lucia",nickname:"LC"},{name:"Saint Martin",nickname:"MF"},{name:"Saint Pierre and Miquelon",nickname:"PM"},{name:"Samoa",nickname:"WS"},{name:"San Marino",nickname:"SM"},{name:"São Tomé and Príncipe",nickname:"ST"},{name:"Saudi Arabia",nickname:"SA"},{name:"Senegal",nickname:"SN"},{name:"Serbia",nickname:"RS"},{name:"Seychelles",nickname:"SC"},{name:"Sierra Leone",nickname:"SL"},{name:"Singapore",nickname:"SG"},{name:"Slovakia",nickname:"SK"},{name:"Slovenia",nickname:"SI"},{name:"Solomon Islands",nickname:"SB"},{name:"Somalia",nickname:"SO"},{name:"South Africa",nickname:"ZA"},{name:"South Georgia &amp; South Sandwich Islands",nickname:"GS"},{name:"South Korea",nickname:"KR"},{name:"Spain",nickname:"ES"},{name:"Sri Lanka",nickname:"LK"},{name:"St. Vincent &amp; Grenadines",nickname:"VC"},{name:"Sudan",nickname:"SD"},{name:"Suriname",nickname:"SR"},{name:"Svalbard and Jan Mayen",nickname:"SJ"},{name:"Swaziland",nickname:"SZ"},{name:"Sweden",nickname:"SE"},{name:"Switzerland",nickname:"CH"},{name:"Syria",nickname:"SY"},{name:"Taiwan",nickname:"TW"},{name:"Tajikistan",nickname:"TJ"},{name:"Tanzania",nickname:"TZ"},{name:"Thailand",nickname:"TH"},{name:"Timor-Leste",nickname:"TL"},{name:"Togo",nickname:"TG"},{name:"Tokelau",nickname:"TK"},{name:"Tonga",nickname:"TO"},{name:"Trinidad and Tobago",nickname:"TT"},{name:"Tunisia",nickname:"TN"},{name:"Turkey",nickname:"TR"},{name:"Turkmenistan",nickname:"TM"},{name:"Turks and Caicos Islands",nickname:"TC"},{name:"Tuvalu",nickname:"TV"},{name:"Uganda",nickname:"UG"},{name:"Ukraine",nickname:"UA"},{name:"Uruguay",nickname:"UY"},{name:"United Arab Emirates",nickname:"AE"},{name:"United Kingdom",nickname:"GB"},{name:"United States",nickname:"US"},{name:"U.S. Outlying Islands",nickname:"UM"},{name:"U.S. Virgin Islands",nickname:"VI"},{name:"Uzbekistan",nickname:"UZ"},{name:"Vanuatu",nickname:"VU"},{name:"Vatican City",nickname:"VA"},{name:"Venezuela",nickname:"VE"},{name:"Vietnam",nickname:"VN"},{name:"Wallis and Futuna",nickname:"WF"},{name:"Western Sahara",nickname:"EH"},{name:"Yemen",nickname:"YE"},{name:"Zambia",nickname:"ZM"},{name:"Zimbabwe",nickname:"ZW"}],e=0,i=a.length;e<i;e++){var r=a[e].nickname;n+=null==r?'<option disabled=="disabled" value="'+a[e].name+'">'+a[e].name+"</option>":'<option data-value="'+a[e].nickname+'" value="'+a[e].name+'">'+a[e].name+"</option>"}$("#addressCountry").html(n)}function renderProvince(n){for(var a='<option value="state">State/Province</option>',e=$("#addressProvince").data("value"),i=0,r=n.length;i<r;i+=1)a+='<option value="'+n[i].stateprovinceName+'"'+(e==n[i].stateprovinceName?"selected":"")+">"+n[i].stateprovinceName+"</option>";$("#addressProvince").html(a)}function renderOrderList(n){var a=$('<div class="order-list" />'),e=[],i=[],r=[];n.forEach(function(n,o){var t="",c=n.orderitemPskuIdnamestr.split(","),d=n.orderitemPskuName.split(",");c.forEach(function(n,a){t+='<div class="order-sku-list-item"><span class="name">'+n+' :</span><span class="value">'+d[a]+"</span></div>"}),e.push(n.orderitemPid),i.push(n.orderitemId),r.push(n.orderitemPskuNumber);var m=n.orderitemPseo?"${APP_PATH}/"+n.orderitemPseo+".html":"javascript:;";a.append($('<div class="order-item"><a href="'+m+'" class="order-img lazyload" data-src="'+n.orderitemProductMainimgurl+'"></a><div class="order-product"><a class="order-product-name" href="'+m+'">'+n.orderitemPname+'</a><div class="order-sku-list">'+t+'</div><div class="order-product-num"><div class="order-product-price"><span class="'+(n.orderitemProductAccoff==100?"product-single-price":"product-define-price")+'">$'+(n.orderitemProductOriginalprice+parseFloat(n.orderitemPskuMoneystr)||0).toFixed(2)+'</span><span class="product-now-price'+(n.orderitemProductAccoff==100?" hide":"")+'">$'+(n.orderitemProductOriginalprice&&n.orderitemProductAccoff?accuracyCal(n.orderitemProductOriginalprice+parseFloat(n.orderitemPskuMoneystr),n.orderitemProductAccoff):0)+'</span></div><span class="icon delete product-delete"></span><div class="product-qty"><span class="group-addon product-sub"><i class="icon sub"></i></span><input type="text" disabled class="product-num" value="'+n.orderitemPskuNumber+'" /><span class="group-addon product-add"><i class="icon plus"></i></span></div></div></div></div>').data("orderitem",n))}),a.data("itemidarr",i.join(",")).data("productidarr",e.join(",")).data("itemnumarr",r.join(","));var o=$('<div class="cart-box"><div class="cart-box-title"><span class="order-sort">2</span>Checkout Review</div><div class="cart-box-body"></div></div>');o.find(".cart-box-body").append(a),$(".checkout-order-list").append(o),new LazyLoad(a.find(".lazyload"),{root:null,rootMargin:"10px",threshold:0})}function renderOrderCoupons(){var n=$('<div class="cart-box"><div class="cart-box-title"><span class="order-sort">3</span>DISCOUNT CODES</div><div class="cart-box-body"><div class="product-coupons hide"></div><div class="order-coupons"><div class="order-coupon-list"></div><div class="order-coupon-group"><input type="text" placeholder="Please enter code" /><button id="order-check-coupon" class="btn btn-pink">APPLY</button></div><div class="order-coupon-tip"></div></div></div></div>');$(".checkout-coupons").html("").append(n),getCouponAreaData(renderCouponAreaData)}function renderOrderBuyerMsg(){var n=$('<div class="cart-box"><div class="cart-box-title"><span class="order-sort">4</span>ADDITIONAL INFORMATION</div><div class="cart-box-body"><div class="order-buyer-msg"><textarea rows="2" placeholder="Any Request,Notes Here."></textarea></div></div></div>');$(".checkout-buy-msg").append(n)}function rednerOrderCal(){var n=calOrderList(),a=$('<div class="cart-box"><div class="cart-box-body"><div class="order-cal"><div class="order-cal-item"><span class="name">prototal</span><span class="value order-cal-prototal">$'+n.prototal.toFixed(2)+'</span></div><div class="order-cal-item"><span class="name">coupon</span><span class="value order-cal-coupon">-$'+n.coupon.toFixed(2)+'</span></div><div class="order-cal-item"><span class="name">shipping</span><span class="value order-cal-shipping">$'+n.shipping.toFixed(2)+'</span></div><div class="order-cal-item"><span class="name">subtotal</span><span class="value order-cal-subtotal" data-price="'+n.subtotal.toFixed(2)+'">$'+n.subtotal.toFixed(2)+'</span></div><div class="order-cal-btn" style="flex-direction: column;"><div class="complete-order complete-order-1 btn btn-yellow" data-id="0"><span class="paypal-btn paypal-btn-1"></span></div><div class="complete-order complete-order-2 btn btn-black" data-id="1"><span class="paypal-btn paypal-btn-2"></span><span>Debit or Credit Card</span></div><div class="paypal-logon"><span class="paypal-power-by">Powered by</span><span class="paypal-btn paypal-btn-3"></span></div></div></div></div></div>');$(".checkout-order-cal").append(a)}function checkInputAdressInfo(){for(var n=!0,a=0,e=$(".address-box .form-group").length;a<e;a+=1){var i=$(".address-box .form-group")[a];if(!$(i).find(".form-control").data("status")&&(!$(i).find(".form-control").val()||"state"==$(i).find(".form-control").val())){mlModalTip('Address information <i style="color: #f00">'+$(i).find(".form-label").text()+"</i> can't be empty !"),$(i).find(".form-control").focus(),n=!1;break}}return n}function checkCouponCode(n,a){$.ajax({url:"${APP_PATH}/MlbackCoupon/getOneMlbackCouponDetailByCode",data:JSON.stringify(n),type:"post",dataType:"json",contentType:"application/json",success:function(n){100==n.code?a&&a(n.extend):sysModalTip()},error:function(n){sysModalTip()}})}function getOrderAddress(){var n={};return $(".address-box .form-control").each(function(a,e){"addressCountry"==e.name&&(n.addressCountryCode=$(e).find("option:checked").data("value")),n[e.name]=(e.value||"").trim()}),n.addressFormatTelephone=formatTelphone(n.addressTelephone,n.addressCountryCode),n}function formatTelphone(e,r){var i=e.replace(/[^\d]/g,"");if(i=(+i||i)+"","US"==r||"CA"==r){if(10==i.length&&"1"!=i[0])return i;if(11==i.length&&"1"==i[0])return i.slice(1)}else if("ZA"==r&&"27"==i.slice(0,2)||"GB"==r&&"44"==i.slice(0,2)||"FR"==r&&"33"==i.slice(0,2))return i.slice(2);return e}function initOrderAddress(n){$(".address-box .form-control").each(function(a,e){"addressProvince"==e.name&&$(e).data("value",n[e.name]),$(e).val(n[e.name])}),isBackFill=!0}function getOrderPayInfo(n){var a=$(".order-coupon-group").data("coupon")||{};return{orderId:$(".order-list").data("orderid")||null,orderOrderitemidstr:$(".order-list").data("itemidarr"),orderCouponId:a.mlbackCouponOne&&a.mlbackCouponOne.couponId||"",orderCouponCode:a.mlbackCouponOne&&a.mlbackCouponOne.couponCode||"",orderPayPlate:n,orderProNumStr:$(".order-list").data("itemnumarr"),orderBuyMess:$(".order-buyer-msg textarea").val(),addressinfoId:$("#addressId").val(),orderCreatetime:$(".order-list").data("productidarr"),orderMotifytime:checkoutviewId}}function initialOrder(){renderCountry();var n=$(".paypal-error-tip");!n.hasClass("hide")&&n.addClass("hide"),$("#addressEmail, #addressCountry, #addressProvince, #addressCity, #addressPost").on("foucs",function(){!n.hasClass("hide")&&n.addClass("hide")}),getUserInfo(function(n){var a=n.mlfrontAddressOne;a&&initOrderAddress(a),$(".order-address-shipping").data("shipping",n.areafreightMoney).find(".value","$"+n.areafreightMoney),countryCombineWithProvince()}),renderOrderBuyerMsg(),renderOrderCoupons(),getProductOrderList(function(n){var a=n.mlfrontOrderItemList;if(!a.length)return mlModalTip("Don't have to pay for goods, please to add items in the shopping cart, and then to pay !"),void goToCartList();renderOrderList(a),renderFreeGift(),$(".order-list").data("orderid",n.orderId)}),rednerOrderCal(),isBackFill&&collectShippingAddress&&collectShippingAddress()}var hasProvince=!0;setTimeout(initialOrder,0),$("#addressCountry").on("change",function(){countryCombineWithProvince(),resetOrderCal()}),$(document.body).on("click",".product-add",function(){productAdd($(this),function(n,a){updateOrderNum(n,a,resetOrderCal)})}),$(document.body).on("click",".product-sub",function(){productSub($(this),function(n,a){updateOrderNum(n,a,resetOrderCal)})}),$(document.body).on("click",".product-delete",function(){deleteOrderProduct($(this).parents(".order-item"),function(n){var a=$(".order-list").data("productidarr").split(","),e=$(".order-list").data("itemnumarr").split(","),i=$(".order-list").data("itemidarr").split(",");i.forEach(function(r,o){r==n&&(a.splice(o,1),i.splice(o,1),e.splice(o,1))}),$(".order-list").data("productidarr",a.join(",")),$(".order-list").data("itemidarr",i.join(",")),$(".order-list").data("itemnumarr",e.join(",")),resetOrderCal()})}),$(document.body).on("click","#order-check-coupon",function(){var n=$(".order-coupon-group input").val().trim();n?checkCouponCode({couponCreatetime:$(".order-list").data("productidarr"),couponCode:n},function(n){$(".order-coupon-group").data("coupon",n),resetOrderCal()}):mlModalTip("Please enter a valid coupon code !")}),$(document.body).on("click",".complete-order",function(){var n=$(this).data("id")||0;checkInputAdressInfo()&&orderSaveAddress(getOrderAddress(),function(a){$("#addressId").val(a.addressId);var e=$(".order-list").data("productidarr")?$(".order-list").data("productidarr").split(","):[],i=$(".order-cal-subtotal").data("price");fbq("track","AddPaymentInfo",{content_ids:e,content_type:"product",value:i,currency:"USD"}),payLoading2(),orderPay(getOrderPayInfo(n),function(){goToPay(n)})})}),$("#addressEmail").on("change",function(){$(".order-coupons").find("input").val(""),$(".order-coupons").find(".order-coupon-tip").html(""),$(".order-coupon-group").data("coupon",""),setTimeout(resetOrderCal)});</script>
<script>function goToPay(e){$.ajax({url:"${APP_PATH}/paypal/mpay?paypalPlatFrom="+e,type:"post",dataType:"json",contentType:"application/json",success:function(e){100==e.code?(""+e.extend.ifPaypalCheckSuccess=="0"&&window.location.reload(),""+e.extend.ifPaypalCheckSuccess=="1"&&(window.location.href=e.extend.redirectUrl),""+e.extend.ifPaypalCheckSuccess=="2"&&(hidePayLoading(),$("html").animate({scrollTop:0},500),setTimeout(function(e){createModal({body:{html:"<p>"+e+"</p>"}})},600,e.extend.errorDetail))):sysModalTip()},error:function(){sysModalTip()}})}</script>
<script>function payLoading2(){var a=parseInt($(".modal").css("z-index"),10)+$(".modal").length+1||99999999999,d=$('<div class="pay-loading" style="z-index: '+a+'"><div style="width:100%;height:100%;background-repeat:no-repeat;background-position:center;background-image:url(${APP_PATH}/static/pc/img/paypal-loading.gif)"></div></div>');$(document.body).append(d),addFixed()}$(".website-policy-item").on("click",function(e){$(this);var t,a='<iframe src="'+e.target.href+'"><iframe>';e.preventDefault(),t=createModal({header:{html:"<p>"+$(this).data("title")+"</p>"},body:{html:a}}),t.addClass("policy-modal")});</script>
