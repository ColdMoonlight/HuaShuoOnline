<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<% pageContext.setAttribute("APP_PATH", request.getContextPath()); %>
<script>function getProductOrderList(a){$.ajax({url:"${APP_PATH}/MlfrontOrder/getNowOrderDetail",type:"get",async:!1,cache:!1,success:function(n){100==n.code&&a&&a(n.extend)}})}function getProvinceData(a,n){$.ajax({url:"${APP_PATH}/MlfrontAddress/getAreafreightMoney",data:JSON.stringify(a),async:!1,type:"post",dataType:"json",contentType:"application/json",async:!1,success:function(a){100==a.code&&n&&n(a.extend)}})}function getUserInfo(a){$.ajax({url:"${APP_PATH}/MlfrontAddress/getOneMlfrontAddressDetailByUinfo",type:"post",dataType:"json",async:!1,success:function(n){a&&a(n.extend)}})}function updateOrderNum(a,n,e){var i=a.parents(".order-item").data("orderitem")||null,r={orderitemId:parseInt(i.orderitemId),orderitemPskuNumber:n};$.ajax({url:"${APP_PATH}/MlfrontOrder/updateOrderItemNum",data:JSON.stringify(r),type:"post",dataType:"json",contentType:"application/json",success:function(o){if(100==o.code){var t=$(".order-list").data("itemnumarr").split(","),c=$(".order-list").data("itemidarr").split(",");c.forEach(function(a,e){""+a==""+r.orderitemId&&(t[e]=n)}),$(".order-list").data("itemnumarr",t.join(",")),updateProructNumberInCart(),i.orderitemPskuNumber=n,a.parents(".order-item").data("orderitem",i),e&&e(),updateProductNumSuccessModal()}else a.find(".product-num").val(i.orderitemPskuNumber),updateProductNumFailModal()},error:function(){a.find(".product-num").val(i.cartitemProductNumber),updateProductNumFailModal()}})}function deleteOrderProduct(a,n){function e(){var a=$(".order-list").data("itemidarr").split(",");a=a.filter(function(a){return a!=r}),$(".order-list").data("itemidarr",a.join(","))}var i=a.data("orderitem")||null,r=parseInt(i.orderitemId),o={orderitemId:r};$.ajax({url:"${APP_PATH}/MlfrontOrder/delOrderItem",data:JSON.stringify(o),type:"post",dataType:"json",contentType:"application/json",success:function(i){a.remove(),$(".order-item").length||goToCartList(),n&&n(r),e(),deleteProductSuccessModal()},error:function(){a.find(".product-num").val(i.cartitemProductNumber),deleteProductFailModal()}})}function orderSaveAddress(a,n){$.ajax({url:"${APP_PATH}/MlfrontAddress/save",type:"post",dataType:"json",data:JSON.stringify(a),contentType:"application/json",success:function(a){100==a.code?n&&n(a.extend.mlfrontAddress):sysModalTip()},error:function(){sysModalTip()}})}function orderPay(a,n){$.ajax({url:"${APP_PATH}/MlfrontOrder/orderToPayInfo",data:JSON.stringify(a),type:"post",dataType:"json",contentType:"application/json",success:function(a){100==a.code?n&&n(a.extend):sysModalTip()},error:function(a){sysModalTip()}})}function countryCombineWithProvince(){getProvinceData({addressCountry:$("#addressCountry").find("option:checked").data("value")},function(a){var n=a.areafreightMoney,e=a.mlPaypalStateprovinceList;$(".order-address-shipping").data("shipping",n).find(".value").text("$"+n),e&&e.length>0?(renderProvince(e),$("#addressProvince").data("status",!1),hasProvince=!0,$("#addressProvince").parents(".form-group").removeClass("hide"),$("#addressCountry").parents(".form-group").css("width","")):($("#addressProvince").val("").data("status",!0),hasProvince=!1,$("#addressProvince").parents(".form-group").addClass("hide"),$("#addressCountry").parents(".form-group").css("width","100%"))})}function calOrderList(){var a=$(".order-coupon-group").data("coupon"),n={prototal:0,subtotal:0,shipping:$(".order-address-shipping").data("shipping")||0,coupon:0},e=($(".order-list").data("productidarr").split(","),[]),i=$("#addressEmail").val().trim();if($(".order-item").each(function(a,e){var i=$(e).data("orderitem"),r=parseFloat((parseFloat(accuracyCal((i.orderitemProductOriginalprice||0)+parseFloat(i.orderitemPskuMoneystr||0),i.orderitemProductAccoff||100))*i.orderitemPskuNumber).toFixed(2));n.prototal+=r}),a&&!a.mlbackCouponOne&&(n.coupon=0,$(".order-coupon-tip").html("<p>"+a.resMsg+"</p>")),a&&a.mlbackCouponOne){function r(e){return!(a.mlbackCouponOne.couponPriceBaseline&&!(a.mlbackCouponOne.couponPriceBaseline&&e>=parseFloat(a.mlbackCouponOne.couponPriceBaseline)))||(n.coupon=0,$(".order-coupon-tip").html('<p>The minimum usage price of this coupon is + <i style="color: #f00">$'+a.mlbackCouponOne.couponPriceBaseline+"<i></p>"),!1)}function o(e){""+a.mlbackCouponOne.couponType=="0"&&(n.coupon=parseFloat(a.mlbackCouponOne.couponPrice)),""+a.mlbackCouponOne.couponType=="1"&&(n.coupon=parseFloat(accuracyCal(e,a.mlbackCouponOne.couponPriceoff||100))),$(".order-coupon-tip").html('<p><i style="color: #f00">'+a.mlbackCouponOne.couponCode+"</i> used successful ! </p>")}function t(a){var n=0;return $(".order-item").each(function(i,r){var o=$(r).data("orderitem"),t=parseFloat((parseFloat(accuracyCal((o.orderitemProductOriginalprice||0)+parseFloat(o.orderitemPskuMoneystr||0),o.orderitemProductAccoff||100))*o.orderitemPskuNumber).toFixed(2));"all"==a&&(n+=t),"products"==a&&e.indexOf(""+o.orderitemPid)>-1&&(n+=t),"collection"==a&&e.indexOf(""+o.orderitemPid)>-1&&(n+=t),"except"==a&&e.indexOf(""+o.orderitemPid)<0&&(n+=t)}),n}function c(a){var n=t(a);n?r(n)&&o(n):$(".order-coupon-tip").html('<p><i style="color: #f00">This coupon does not apply to the currently purchased product! </p>')}function d(){""+a.mlbackCouponOne.couponProductonlyType!="0"&&a.mlbackCouponOne.couponProductonlyType||c("all"),""+a.mlbackCouponOne.couponProductonlyType=="1"&&(e=a.mlbackCouponOne.couponProductonlyPidstr&&a.mlbackCouponOne.couponProductonlyPidstr.split(","),c("products")),""+a.mlbackCouponOne.couponProductonlyType=="2"&&(e=a.mlbackCouponOne.couponProsFromApplyCateidstr&&a.mlbackCouponOne.couponProsFromApplyCateidstr.split(","),c("collection")),""+a.mlbackCouponOne.couponProductonlyType=="3"&&(e=a.mlbackCouponOne.couponAllExceptPidstr&&a.mlbackCouponOne.couponAllExceptPidstr.split(","),c("except"))}""+a.mlbackCouponOne.couponCodeUniqueEmailIF=="1"?i?a.mlbackCouponOne.couponCodeUniqueEmail&&a.mlbackCouponOne.couponCodeUniqueEmail.indexOf(i)>-1?d():(n.coupon=0,$(".order-coupon-tip").html("<p>This coupon is only applicable to designated users!</p>")):(mlModalTip("This is an exclusive coupon, you need to complete the address information!"),$(".order-coupon-tip").html(""),$("html").animate({scrollTop:0},500)):d()}return n.subtotal=n.prototal+n.shipping-n.coupon,n.coupon<=0&&$(".order-coupon-group").data("coupon",""),showFreeGift(n.prototal),n}function resetOrderCal(){var a=calOrderList();$(".order-cal-prototal").text("$"+a.prototal.toFixed(2)),$(".order-cal-shipping").text("$"+a.shipping.toFixed(2)),$(".order-cal-coupon").text("-$"+a.coupon.toFixed(2)),$(".order-cal-subtotal").text("$"+a.subtotal.toFixed(2)).data("price",a.subtotal.toFixed(2))}function renderCountry(){for(var a="",n=[{name:"United States",nickname:"US"},{name:"United Kingdom",nickname:"GB"},{name:"Canada",nickname:"CA"},{name:"Nigeria",nickname:"NG"},{name:"Australia",nickname:"AU"},{name:"South Africa",nickname:"ZA"},{name:"Germany",nickname:"DE"},{name:"Kenya",nickname:"KE"},{name:"Spain",nickname:"ES"},{name:"United Arab Emirates",nickname:"AE"},{name:"France",nickname:"FR"},{name:"--------------------",nickname:null},{name:"Afghanistan",nickname:"AF"},{name:"Åland Islands",nickname:"AX"},{name:"Albania",nickname:"AL"},{name:"Algeria",nickname:"DZ"},{name:"American Samoa",nickname:"AS"},{name:"Andorra",nickname:"AD"},{name:"Angola",nickname:"AO"},{name:"Anguilla",nickname:"AI"},{name:"Antarctica",nickname:"AQ"},{name:"Antigua and Barbuda",nickname:"AG"},{name:"Argentina",nickname:"AR"},{name:"Armenia",nickname:"AM"},{name:"Aruba",nickname:"AW"},{name:"Australia",nickname:"AU"},{name:"Austria",nickname:"AT"},{name:"Azerbaijan",nickname:"AZ"},{name:"Bahamas",nickname:"BS"},{name:"Bahrain",nickname:"BH"},{name:"Bangladesh",nickname:"BD"},{name:"Barbados",nickname:"BB"},{name:"Belarus",nickname:"BY"},{name:"Belgium",nickname:"BE"},{name:"Belize",nickname:"BZ"},{name:"Benin",nickname:"BJ"},{name:"Bermuda",nickname:"BM"},{name:"Bhutan",nickname:"BT"},{name:"Bolivia",nickname:"BO"},{name:"Bosnia and Herzegovina",nickname:"BA"},{name:"Botswana",nickname:"BW"},{name:"Bouvet Island",nickname:"BV"},{name:"Brazil",nickname:"BR"},{name:"British Indian Ocean Territory",nickname:"IO"},{name:"British Virgin Islands",nickname:"VG"},{name:"Brunei",nickname:"BN"},{name:"Bulgaria",nickname:"BG"},{name:"Burkina Faso",nickname:"BF"},{name:"Burundi",nickname:"BI"},{name:"Cambodia",nickname:"KH"},{name:"Canada",nickname:"CA"},{name:"Cameroon",nickname:"CM"},{name:"Cape Verde",nickname:"CV"},{name:"Cayman Islands",nickname:"KY"},{name:"Central African Republic",nickname:"CF"},{name:"Chad",nickname:"TD"},{name:"Chile",nickname:"CL"},{name:"China",nickname:"CN"},{name:"Christmas Island",nickname:"CX"},{name:"Cocos (Keeling) Islands",nickname:"CC"},{name:"Colombia",nickname:"CO"},{name:"Comoros",nickname:"KM"},{name:"Congo - Brazzaville",nickname:"CG"},{name:"Congo - Kinshasa",nickname:"CD"},{name:"Cook Islands",nickname:"CK"},{name:"Costa Rica",nickname:"CR"},{name:"Côte d’Ivoire",nickname:"CI"},{name:"Croatia",nickname:"HR"},{name:"Cuba",nickname:"CU"},{name:"Cyprus",nickname:"CY"},{name:"Czech Republic",nickname:"CZ"},{name:"Denmark",nickname:"DK"},{name:"Djibouti",nickname:"DJ"},{name:"Dominica",nickname:"DM"},{name:"Dominican Republic",nickname:"DO"},{name:"Ecuador",nickname:"EC"},{name:"Egypt",nickname:"EG"},{name:"El Salvador",nickname:"SV"},{name:"Equatorial Guinea",nickname:"GQ"},{name:"Eritrea",nickname:"ER"},{name:"Estonia",nickname:"EE"},{name:"Ethiopia",nickname:"ET"},{name:"Falkland Islands",nickname:"FK"},{name:"Faroe Islands",nickname:"FO"},{name:"France",nickname:"FR"},{name:"Fiji",nickname:"FJ"},{name:"Finland",nickname:"FI"},{name:"Gabon",nickname:"GA"},{name:"Gambia",nickname:"GM"},{name:"Georgia",nickname:"GE"},{name:"Germany",nickname:"DE"},{name:"Ghana",nickname:"GH"},{name:"Gibraltar",nickname:"GI"},{name:"Greece",nickname:"GR"},{name:"Greenland",nickname:"GL"},{name:"Grenada",nickname:"GD"},{name:"Guadeloupe",nickname:"GP"},{name:"Guam",nickname:"GU"},{name:"Guatemala",nickname:"GT"},{name:"Guernsey",nickname:"GG"},{name:"Guinea",nickname:"GN"},{name:"Guinea-Bissau",nickname:"GW"},{name:"Guyana",nickname:"GY"},{name:"Haiti",nickname:"HT"},{name:"Heard &amp; McDonald Islands",nickname:"HM"},{name:"Honduras",nickname:"HN"},{name:"Hong Kong SAR China",nickname:"HK"},{name:"Hungary",nickname:"HU"},{name:"Iceland",nickname:"IS"},{name:"India",nickname:"IN"},{name:"Indonesia",nickname:"ID"},{name:"Iran",nickname:"IR"},{name:"Iraq",nickname:"IQ"},{name:"Ireland",nickname:"IE"},{name:"Isle of Man",nickname:"IM"},{name:"Israel",nickname:"IL"},{name:"Italy",nickname:"IT"},{name:"Jamaica",nickname:"JM"},{name:"Japan",nickname:"JP"},{name:"Jersey",nickname:"JE"},{name:"Jordan",nickname:"JO"},{name:"Kazakhstan",nickname:"KZ"},{name:"Kenya",nickname:"KE"},{name:"Kiribati",nickname:"KI"},{name:"Kuwait",nickname:"KW"},{name:"Kyrgyzstan",nickname:"KG"},{name:"Laos",nickname:"LA"},{name:"Latvia",nickname:"LV"},{name:"Lebanon",nickname:"LB"},{name:"Lesotho",nickname:"LS"},{name:"Liberia",nickname:"LR"},{name:"Libya",nickname:"LY"},{name:"Liechtenstein",nickname:"LI"},{name:"Lithuania",nickname:"LT"},{name:"Luxembourg",nickname:"LU"},{name:"Macau SAR China",nickname:"MO"},{name:"Macedonia",nickname:"MK"},{name:"Madagascar",nickname:"MG"},{name:"Malawi",nickname:"MW"},{name:"Malaysia",nickname:"MY"},{name:"Maldives",nickname:"MV"},{name:"Mali",nickname:"ML"},{name:"Malta",nickname:"MT"},{name:"Marshall Islands",nickname:"MH"},{name:"Martinique",nickname:"MQ"},{name:"Mauritania",nickname:"MR"},{name:"Mauritius",nickname:"MU"},{name:"Mayotte",nickname:"YT"},{name:"Mexico",nickname:"MX"},{name:"Micronesia",nickname:"FM"},{name:"Moldova",nickname:"MD"},{name:"Monaco",nickname:"MC"},{name:"Mongolia",nickname:"MN"},{name:"Montenegro",nickname:"ME"},{name:"Montserrat",nickname:"MS"},{name:"Morocco",nickname:"MA"},{name:"Mozambique",nickname:"MZ"},{name:"Myanmar (Burma)",nickname:"MM"},{name:"Namibia",nickname:"NA"},{name:"Nauru",nickname:"NR"},{name:"Nepal",nickname:"NP"},{name:"Netherlands",nickname:"NL"},{name:"Netherlands Antilles",nickname:"AN"},{name:"New Caledonia",nickname:"NC"},{name:"New Zealand",nickname:"NZ"},{name:"Nicaragua",nickname:"NI"},{name:"Niger",nickname:"NE"},{name:"Nigeria",nickname:"NG"},{name:"Niue",nickname:"NU"},{name:"Norfolk Island",nickname:"NF"},{name:"Northern Mariana Islands",nickname:"MP"},{name:"North Korea",nickname:"KP"},{name:"Norway",nickname:"NO"},{name:"Oman",nickname:"OM"},{name:"Pakistan",nickname:"PK"},{name:"Palau",nickname:"PW"},{name:"Palestinian Territories",nickname:"PS"},{name:"Panama",nickname:"PA"},{name:"Papua New Guinea",nickname:"PG"},{name:"Paraguay",nickname:"PY"},{name:"Peru",nickname:"PE"},{name:"Philippines",nickname:"PH"},{name:"Pitcairn Islands",nickname:"PN"},{name:"Poland",nickname:"PL"},{name:"Portugal",nickname:"PT"},{name:"Puerto Rico",nickname:"PR"},{name:"Qatar",nickname:"QA"},{name:"Réunion",nickname:"RE"},{name:"Romania",nickname:"RO"},{name:"Russia",nickname:"RU"},{name:"Rwanda",nickname:"RW"},{name:"Saint Barthélemy",nickname:"BL"},{name:"Saint Helena",nickname:"SH"},{name:"Saint Kitts and Nevis",nickname:"KN"},{name:"Saint Lucia",nickname:"LC"},{name:"Saint Martin",nickname:"MF"},{name:"Saint Pierre and Miquelon",nickname:"PM"},{name:"Samoa",nickname:"WS"},{name:"San Marino",nickname:"SM"},{name:"São Tomé and Príncipe",nickname:"ST"},{name:"Saudi Arabia",nickname:"SA"},{name:"Senegal",nickname:"SN"},{name:"Serbia",nickname:"RS"},{name:"Seychelles",nickname:"SC"},{name:"Sierra Leone",nickname:"SL"},{name:"Singapore",nickname:"SG"},{name:"Slovakia",nickname:"SK"},{name:"Slovenia",nickname:"SI"},{name:"Solomon Islands",nickname:"SB"},{name:"Somalia",nickname:"SO"},{name:"South Africa",nickname:"ZA"},{name:"South Georgia &amp; South Sandwich Islands",nickname:"GS"},{name:"South Korea",nickname:"KR"},{name:"Spain",nickname:"ES"},{name:"Sri Lanka",nickname:"LK"},{name:"St. Vincent &amp; Grenadines",nickname:"VC"},{name:"Sudan",nickname:"SD"},{name:"Suriname",nickname:"SR"},{name:"Svalbard and Jan Mayen",nickname:"SJ"},{name:"Swaziland",nickname:"SZ"},{name:"Sweden",nickname:"SE"},{name:"Switzerland",nickname:"CH"},{name:"Syria",nickname:"SY"},{name:"Taiwan",nickname:"TW"},{name:"Tajikistan",nickname:"TJ"},{name:"Tanzania",nickname:"TZ"},{name:"Thailand",nickname:"TH"},{name:"Timor-Leste",nickname:"TL"},{name:"Togo",nickname:"TG"},{name:"Tokelau",nickname:"TK"},{name:"Tonga",nickname:"TO"},{name:"Trinidad and Tobago",nickname:"TT"},{name:"Tunisia",nickname:"TN"},{name:"Turkey",nickname:"TR"},{name:"Turkmenistan",nickname:"TM"},{name:"Turks and Caicos Islands",nickname:"TC"},{name:"Tuvalu",nickname:"TV"},{name:"Uganda",nickname:"UG"},{name:"Ukraine",nickname:"UA"},{name:"Uruguay",nickname:"UY"},{name:"United Arab Emirates",nickname:"AE"},{name:"United Kingdom",nickname:"GB"},{name:"United States",nickname:"US"},{name:"U.S. Outlying Islands",nickname:"UM"},{name:"U.S. Virgin Islands",nickname:"VI"},{name:"Uzbekistan",nickname:"UZ"},{name:"Vanuatu",nickname:"VU"},{name:"Vatican City",nickname:"VA"},{name:"Venezuela",nickname:"VE"},{name:"Vietnam",nickname:"VN"},{name:"Wallis and Futuna",nickname:"WF"},{name:"Western Sahara",nickname:"EH"},{name:"Yemen",nickname:"YE"},{name:"Zambia",nickname:"ZM"},{name:"Zimbabwe",nickname:"ZW"}],e=0,i=n.length;e<i;e++){var r=n[e].nickname;a+=null==r?'<option disabled=="disabled" value="'+n[e].name+'">'+n[e].name+"</option>":'<option data-value="'+n[e].nickname+'" value="'+n[e].name+'">'+n[e].name+"</option>"}$("#addressCountry").html(a)}function renderProvince(a){for(var n='<option value="state">State/Province</option>',e=$("#addressProvince").data("value"),i=0,r=a.length;i<r;i+=1)n+='<option value="'+a[i].stateprovinceName+'"'+(e==a[i].stateprovinceName?"selected":"")+">"+a[i].stateprovinceName+"</option>";$("#addressProvince").html(n)}function renderOrderList(a){var n=$('<div class="order-list" />'),e=[],i=[],r=[];a.forEach(function(a,o){var t="",c=a.orderitemPskuIdnamestr.split(","),d=a.orderitemPskuName.split(",");c.forEach(function(a,n){t+='<div class="order-sku-list-item"><span class="name">'+a+' :</span><span class="value">'+d[n]+"</span></div>"}),e.push(a.orderitemPid),i.push(a.orderitemId),r.push(a.orderitemPskuNumber);var m=a.orderitemPseo?"${APP_PATH}/"+a.orderitemPseo+".html":"javascript:;";n.append($('<div class="order-item"><a href="'+m+'" class="order-img lazyload" data-src="'+a.orderitemProductMainimgurl+'"></a><div class="order-product"><a class="order-product-name" href="'+m+'">'+a.orderitemPname+'</a><div class="order-sku-list">'+t+'</div><div class="order-product-num"><div class="order-product-price"><span class="product-define-price">$'+(a.orderitemProductOriginalprice+parseFloat(a.orderitemPskuMoneystr)||0).toFixed(2)+'</span><span class="product-now-price">$'+(a.orderitemProductOriginalprice&&a.orderitemProductAccoff?accuracyCal(a.orderitemProductOriginalprice+parseFloat(a.orderitemPskuMoneystr),a.orderitemProductAccoff):0)+'</span></div><span class="icon delete product-delete"></span><div class="product-qty"><span class="group-addon product-sub"><i class="icon sub"></i></span><input type="text" disabled class="product-num" value="'+a.orderitemPskuNumber+'" /><span class="group-addon product-add"><i class="icon plus"></i></span></div></div></div></div>').data("orderitem",a))}),n.data("itemidarr",i.join(",")).data("productidarr",e.join(",")).data("itemnumarr",r.join(","));var o=$('<div class="cart-box"><div class="cart-box-title"><span class="order-sort">2</span>Checkout Review</div><div class="cart-box-body"></div></div>');o.find(".cart-box-body").append(n),$(".checkout-order-list").append(o),new LazyLoad(n.find(".lazyload"),{root:null,rootMargin:"10px",threshold:0})}function renderOrderCoupons(){var a=$('<div class="cart-box"><div class="cart-box-title"><span class="order-sort">3</span>DISCOUNT CODES</div><div class="cart-box-body"><div class="product-coupons hide"></div><div class="order-coupons"><div class="order-coupon-list"></div><div class="order-coupon-group"><input type="text" placeholder="Please enter code" /><button id="order-check-coupon" class="btn btn-pink">APPLY</button></div><div class="order-coupon-tip"></div></div></div></div>');$(".checkout-coupons").html("").append(a),getCouponAreaData(renderCouponAreaData)}function renderOrderPaymentMethod(){var a=$('<div class="cart-box"><div class="cart-box-title"><span class="order-sort">4</span>PAYMENT METHOD</div><div class="cart-box-body"><div class="order-payment" data-pay="0"><div class="order-payment-item"><div class="order-pay-inner custom-check"><input type="radio" name="payment" id="payment-paypal" checked value="0"><label for="payment-paypal"><img src="${APP_PATH}/static/pc/img/paypal-1.png"><span>Pay with PayPal account</span></label></div><div class="paypal-box"><img src="${APP_PATH}/static/pc/img/paypal-3.svg"><div class="paypal-des">After clicking “Complete order”, you will be redirected to PayPal to complete your purchase securely.</div></div></div><div class="order-payment-item"><div class="order-pay-inner custom-check"><input type="radio" name="payment" id="payment-paypalcard" value="1"><label for="payment-paypalcard"><img src="${APP_PATH}/static/pc/img/paypal-2-2.png"><sapn style="white-space: nowrap;">Pay with Paypal Credit card</span></label></div><div class="paypal-box hide"><img src="${APP_PATH}/static/pc/img/paypal-3.svg"><div class="paypal-des">After clicking “complete order”, you will be redirected to PayPal to complete your purchase safely with several credit cards supported by PayPal.</div></div></div><div class="card-element-box mask hide"><div class="spinner"></div><div id="card-element"></div><p id="card-error" role="alert"></p></div></div></div></div>');$(".checkout-pay-method").append(a)}function renderOrderBuyerMsg(){var a=$('<div class="cart-box"><div class="cart-box-title"><span class="order-sort">5</span>ADDITIONAL INFORMATION</div><div class="cart-box-body"><div class="order-buyer-msg"><textarea rows="2" placeholder="Any Request,Notes Here."></textarea></div></div></div>');$(".checkout-buy-msg").append(a)}function rednerOrderCal(){var a=calOrderList(),n=$('<div class="cart-box"><div class="cart-box-body"><div class="order-cal"><div class="order-cal-item"><span class="name">prototal</span><span class="value order-cal-prototal">$'+a.prototal.toFixed(2)+'</span></div><div class="order-cal-item"><span class="name">coupon</span><span class="value order-cal-coupon">-$'+a.coupon.toFixed(2)+'</span></div><div class="order-cal-item"><span class="name">shipping</span><span class="value order-cal-shipping">$'+a.shipping.toFixed(2)+'</span></div><div class="order-cal-item"><span class="name">subtotal</span><span class="value order-cal-subtotal" data-price="'+a.subtotal.toFixed(2)+'">$'+a.subtotal.toFixed(2)+'</span></div><div class="order-cal-btn"><a href="javascript:;" id="pay-now" class="btn btn-pink">Complete Order</a><button id="payment-form" class="btn btn-pink hide" disabled><div class="spinner hide"></div><span class="btn-text">Pay Securely Now</span></button></div></div></div></div>');$(".checkout-order-cal").append(n)}function checkInputAdressInfo(){for(var a=!0,n=0,e=$(".address-box .form-group").length;n<e;n+=1){var i=$(".address-box .form-group")[n];if(!$(i).find(".form-control").data("status")&&(!$(i).find(".form-control").val()||"state"==$(i).find(".form-control").val())){mlModalTip('Address information <i style="color: #f00">'+$(i).find(".form-label").text()+"</i> can't be empty !"),$(i).find(".form-control").focus(),a=!1;break}}return a}function checkCouponCode(a,n){$.ajax({url:"${APP_PATH}/MlbackCoupon/getOneMlbackCouponDetailByCode",data:JSON.stringify(a),type:"post",dataType:"json",contentType:"application/json",success:function(a){100==a.code?n&&n(a.extend):sysModalTip()},error:function(a){sysModalTip()}})}function getOrderAddress(){var a={};return $(".address-box .form-control").each(function(n,e){"addressCountry"==e.name&&(a.addressCountryCode=$(e).find("option:checked").data("value")),a[e.name]=(e.value||"").trim()}),a}function initOrderAddress(a){$(".address-box .form-control").each(function(n,e){"addressProvince"==e.name&&$(e).data("value",a[e.name]),$(e).val(a[e.name])}),isBackFill=!0}function getOrderPayInfo(){var a=$(".order-coupon-group").data("coupon")||{};return{orderId:$(".order-list").data("orderid")||null,orderOrderitemidstr:$(".order-list").data("itemidarr"),orderCouponId:a.mlbackCouponOne&&a.mlbackCouponOne.couponId||"",orderCouponCode:a.mlbackCouponOne&&a.mlbackCouponOne.couponCode||"",orderPayPlate:$('input[name="payment"]:checked').val(),orderProNumStr:$(".order-list").data("itemnumarr"),orderBuyMess:$(".order-buyer-msg textarea").val(),addressinfoId:$("#addressId").val(),orderCreatetime:$(".order-list").data("productidarr"),orderMotifytime:checkoutviewId}}function initialOrder(){renderCountry();var a=$(".paypal-error-tip");!a.hasClass("hide")&&a.addClass("hide"),$("#addressEmail, #addressCountry, #addressProvince, #addressCity, #addressPost").on("foucs",function(){!a.hasClass("hide")&&a.addClass("hide")}),getUserInfo(function(a){var n=a.mlfrontAddressOne;n&&initOrderAddress(n),$(".order-address-shipping").data("shipping",a.areafreightMoney).find(".value","$"+a.areafreightMoney),countryCombineWithProvince()}),renderOrderPaymentMethod(),renderOrderBuyerMsg(),renderOrderCoupons(),getProductOrderList(function(a){var n=a.mlfrontOrderItemList;if(!n.length)return mlModalTip("Don't have to pay for goods, please to add items in the shopping cart, and then to pay !"),void goToCartList();renderOrderList(n),renderFreeGift(),$(".order-list").data("orderid",a.orderId)}),rednerOrderCal(),isBackFill&&collectShippingAddress&&collectShippingAddress()}var hasProvince=!0;setTimeout(initialOrder,0),$("#addressCountry").on("change",function(){countryCombineWithProvince(),resetOrderCal()}),$(document.body).on("click",".product-add",function(){productAdd($(this),function(a,n){updateOrderNum(a,n,resetOrderCal)})}),$(document.body).on("click",".product-sub",function(){productSub($(this),function(a,n){updateOrderNum(a,n,resetOrderCal)})}),$(document.body).on("click",".product-delete",function(){deleteOrderProduct($(this).parents(".order-item"),function(a){var n=$(".order-list").data("productidarr").split(","),e=$(".order-list").data("itemnumarr").split(","),i=$(".order-list").data("itemidarr").split(",");i.forEach(function(r,o){r==a&&(n.splice(o,1),i.splice(o,1),e.splice(o,1))}),$(".order-list").data("productidarr",n.join(",")),$(".order-list").data("itemidarr",i.join(",")),$(".order-list").data("itemnumarr",e.join(",")),resetOrderCal()})}),$(document.body).on("click","#order-check-coupon",function(){var a=$(".order-coupon-group input").val().trim();a?checkCouponCode({couponCreatetime:$(".order-list").data("productidarr"),couponCode:a},function(a){$(".order-coupon-group").data("coupon",a),resetOrderCal()}):mlModalTip("Please enter a valid coupon code !")}),$(document.body).on("click","#pay-now",function(){checkInputAdressInfo()&&orderSaveAddress(getOrderAddress(),function(a){$("#addressId").val(a.addressId);var n=$(".order-list").data("productidarr")?$(".order-list").data("productidarr").split(","):[],e=$(".order-cal-subtotal").data("price");fbq("track","AddPaymentInfo",{content_ids:n,content_type:"product",value:e,currency:"USD"}),payLoading(),orderPay(getOrderPayInfo(),goToPay)})}),$("#addressEmail").on("change",function(){$(".order-coupons").find("input").val(""),$(".order-coupons").find(".order-coupon-tip").html(""),$(".order-coupon-group").data("coupon",""),setTimeout(resetOrderCal)});</script>
<script>function goToPay(){$.ajax({url:"${APP_PATH}/paypal/mpay?paypalPlatFrom="+$('input[name="payment"]:checked').val(),type:"post",dataType:"json",contentType:"application/json",success:function(e){100==e.code?(""+e.extend.ifPaypalCheckSuccess=="0"&&window.location.reload(),""+e.extend.ifPaypalCheckSuccess=="1"&&(window.location.href=e.extend.redirectUrl),""+e.extend.ifPaypalCheckSuccess=="2"&&(hidePayLoading(),$("html").animate({scrollTop:0},500),setTimeout(function(e){createModal({body:{html:"<p>"+e+"</p>"}})},600,e.extend.errorDetail))):sysModalTip()},error:function(){sysModalTip()}})}</script>
<script>$(".website-policy-item").on("click",function(e){$(this);var a,t='<iframe src="'+e.target.href+'"><iframe>';e.preventDefault(),a=createModal({header:{html:"<p>"+$(this).data("title")+"</p>"},body:{html:t}}),a.addClass("policy-modal")}),$(document.body).on("change",'input[type="radio"][name="payment"]',function(){$(".paypal-box").addClass("hide"),$(this).parents(".order-payment-item").find(".paypal-box").removeClass("hide")});</script>
