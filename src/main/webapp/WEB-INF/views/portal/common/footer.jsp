<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<% pageContext.setAttribute("APP_PATH", request.getContextPath()); %>
<script>function addFixed(){$(document.body).css({overflow:"hidden"})}function removeFixed(){$(document.body).css({overflow:"auto"})}function productAdd(el,callback){var parentEl=el.parents(".product-qty"),max=1/0,curr=parseInt(parentEl.find(".product-num").val());(curr+=1)>1/0&&mlModalTip("<p>Existing inventory <b>"+(curr=1/0)+"</b> pieces !</p>"),parentEl.find(".product-num").val(curr),callback&&callback(parentEl,curr)}function productSub(el,callback){var parentEl=el.parents(".product-qty"),curr=parseInt(parentEl.find(".product-num").val());(curr-=1)<1&&(curr=1,mlModalTip("<p>At least one product !</p>")),parentEl.find(".product-num").val(curr),callback&&callback(parentEl,curr)}function getProductOption(callback){$.ajax({url:"${APP_PATH}/MlbackProductAttributeName/getMlbackProductAttributeNameListByProductId",data:JSON.stringify({productattrnamePid:productId}),dataType:"json",contentType:"application/json",type:"post",async:!1,success:function(data){100==data.code&&callback&&callback(data.extend.mbackProductAttributeNameResList)}})}function renderProductOptions(data,selectedRadioArr){function createOption(data,value){var optionName=data.productattrnameName,optionValue=data.productattrnameValues.split(","),optionItem=$('<div class="product-option-item" data-type="'+optionName+'" data-id="'+data.productattrnameId+'" />'),htmlStr='<div class="name">'+optionName+":</div>";optionObj[optionName]=optionValue,optionIdArr.push(data.productattrnameId),htmlStr+='<div class="body">',optionValue.forEach((function(item,idx){htmlStr+='<span class="radio'+(value==item?" active":"")+'" data-text="'+item+'">'+item+"</span>"})),htmlStr+="</div>",optionItem.html(htmlStr),$(".product-options").append(optionItem)}data.forEach((function(item,idx){createOption(item,selectedRadioArr&&selectedRadioArr[idx])}))}function getCouponAreaData(callback){$.ajax({url:"${APP_PATH}/MlbackCouponDescTitle/getMlbackCouponDescTitleListByStatus",contentType:"application/json",type:"post",async:!1,success:function(data){100==data.code&&callback&&callback(data.extend)}})}function renderCouponAreaData(data){function generateCouponAreaDetailsListData(data){var html="";return data.forEach((function(item,idx){html+="<li>"+item.coupondescdetailStrengthpre+"&nbsp;<span>&nbsp;"+item.coupondescdetailStrength+"&nbsp;</span>&nbsp;"+item.coupondescdetailCodepre+"&nbsp;<b>&nbsp;"+item.coupondescdetailCode+"</b></li>"})),html}var $el=$(".product-coupons"),htmlStr='<div class="left lazyload" data-src="'+data.mlbackCouponDescTitleList[0].coupondesctieleImgurl+'"></div><div class="right"><div class="title">'+data.mlbackCouponDescTitleList[0].coupondesctieleTieledetail+'</div><ul class="body">'+generateCouponAreaDetailsListData(data.mlbackCouponDescDetailList)+"</ul></div>";$el.html(htmlStr),data.mlbackCouponDescTitleList[0].coupondesctieleStatus&&$el.removeClass("hide"),new LazyLoad($el.find(".lazyload"),{root:null,rootMargin:"10px",threshold:0})}function getProductSkus(callback){$.ajax({url:"${APP_PATH}/MlbackProductSku/customerGetMlbackProductSkuListByPId",data:JSON.stringify({productskuPid:productId,productskuStatus:1}),dataType:"json",contentType:"application/json",type:"post",async:!1,success:function(data){100==data.code&&callback&&callback(data.extend.mlbackProductSkuResList)}})}function buildResult(items){for(var paths=getPaths(items),i=0;i<paths.length;i+=1)for(var curr=paths[i],stock=items[i].productskuStock||0,arr,allSets=powerset(curr.split(",")),j=0;j<allSets.length;j+=1){var subSet=allSets[j].join(",");mapSet[subSet]?mapSet[subSet].count+=stock:mapSet[subSet]={count:stock}}}function getPaths(items){return items.reduce((function(acc,item){return mapItems[item.productskuName]=item,acc.push(item.productskuName),acc}),[])}function trimSpliter(str){var reLeft=new RegExp("^,+","g"),reRight=new RegExp(",+$","g"),reSpliter=new RegExp(",+","g");return str.replace(reLeft,"").replace(reRight,"").replace(reSpliter,",")}function getSelectedItem(){var selectedItems=[];return $(".product-option-item").each((function(){var $selected=$(this).find(".radio.active");$selected.length?selectedItems.push($selected.data("text")):selectedItems.push("")})),selectedItems}function powerset(arr){for(var ps=[[]],i=0;i<arr.length;i+=1)for(var j=0,len=ps.length;j<len;j+=1)ps.push(ps[j].concat(arr[i]));return ps}function updateProductStatus(selected){for(var keys=Object.keys(optionObj),i=0,len=keys.length;i<len;i+=1)for(var key=keys[i],data=optionObj[key],selectArr=selected.slice(),j=0;j<data.length;j+=1){var item=data[j],curr,$item;selectArr[i]=item,curr=trimSpliter(selectArr.join(","),","),$item=$('.product-option-item[data-type="'+key+'"]').find('.radio[data-text="'+item+'"]'),mapSet[curr]&&mapSet[curr].count?$item.removeClass("disabled"):$item.addClass("disabled").removeClass("active")}}function handleNormalClick(el){el.hasClass("active")?(el.siblings().removeClass("disabled"),el.removeClass("active")):(el.siblings().removeClass("active"),el.addClass("active"))}function showResult(){for(var selectedItems=getSelectedItem(),selectedKeys=[],i=0;i<selectedItems.length;i+=1){var item=selectedItems[i];item&&selectedKeys.push(item)}updateProductData(selectedKeys)}function isCorrectProduct(){var optionItems=$(".product-option-item"),len=optionItems.length,flag=!0;if(!len)return cannotBuyProductModal(),!1;for(var i=0;i<len;i+=1){var $optionItem=$(optionItems[i]);if(!$optionItem.find(".radio.active").length){mlModalTip("Please select a product specifications and options: "+$optionItem.data("type")),flag=!1;break}}return flag}function mergeOpts(opts1,opts2){var res=$.extend(!0,{},opts1,opts2);return $.each(opts2,(function(key,value){$.isArray(value)&&(res[key]=value)})),res}function createModal(option){var opt=mergeOpts({header:{html:"",isShow:!0},body:{html:"",isShow:!0},footer:{html:"",isShow:!1},autoClose:!1,blockEvent:!1},option),htmlStr="",timer=null,modal=$('<div class="modal"><div class="modal-close icon close"></div><div class="modal-container">'+(opt.header.isShow?'<div class="modal-header">'+(opt.header.html?opt.header.html:"<p>Megalook Tip !</p>")+"</div>":"")+'<div class="modal-body">'+opt.body.html+"</div>"+(opt.footer.isShow?'<div class="modal-footer">'+(opt.footer.html?opt.footer.html:'<button class="btn btn-gray modal-no"> No </button><button class="btn btn-pink modal-ok"> Yes </button>')+"</div>":"")+"</div></div>");function openTimer(){timer=setTimeout((function(){removeModal(modal)}),1500)}function setModalZindex(modal){var modalLen=$(".modal").length;modalLen&&modal.css("z-index",parseInt($(".modal").css("z-index"),10)+modalLen+1)}if($(document.body).append(modal),setTimeout((function(){modal.addClass("active")})),addFixed(),setModalZindex(modal),opt.autoClose){openTimer();var modalContainer=modal.find(".modal-container");modalContainer.on("mouseenter",(function(){clearTimeout(timer)})),modalContainer.on("mouseleave",(function(){openTimer()}))}return opt.blockEvent||(modal.on("click",(function(e){e.target==this&&removeModal($(this))})),modal.find(".modal-close, .modal-no").on("click",(function(e){removeModal(modal)}))),modal}function removeModal(modal){modal.remove(),!$(".modal").length&&removeFixed()}function mlModalTip(text){var modal=createModal({body:{html:"<p>"+text+"</p>"},autoClose:!0})}function sysModalTip(){mlModalTip("Settlement system error, temporarily unable to get data, please try again later !")}function refreshPageModal(){mlModalTip("please refresh the page to get again !")}function deleteProductSuccessModal(){mlModalTip("Successfully deleting  the product !")}function deleteProductFailModal(){mlModalTip("Failed to delete the product !")}function updateProductNumSuccessModal(){mlModalTip("Successfully updating the product !")}function updateProductNumFailModal(){mlModalTip("Failed to update the product !")}function cannotBuyProductModal(){mlModalTip("I'm sorry, the goods temporarily can't buy !")}function loginNotTip(){var loginModal;createModal({header:{isShow:!1},body:{html:"<p>Not logged in, 3s later, it will jump to the homepage !</p>"},blockEvent:!0}).find(".modal-close").hide(),setTimeout(goToIndex,3e3)}function payLoading(){var zIndex=parseInt($(".modal").css("z-index"),10)+$(".modal").length+1||99999999999,$payLoading=$('<div class="pay-loading" style="z-index: '+zIndex+'"><div class="load-list"><div class="loader-item"></div><div class="loader-item"></div><div class="loader-item"></div></div>');$(document.body).append($payLoading),addFixed()}function hidePayLoading(){$(".pay-loading").remove(),removeFixed()}function goToIndex(){window.location.href="${APP_PATH}/"}function goToCheckout(){window.location.href="${APP_PATH}/MlbackCart/toCheakOut"}function goToCartList(){window.location.href="${APP_PATH}/MlbackCart/toCartList"}function goToPay(){window.location.href="${APP_PATH}/paypal/mpay"}function goTopayInstance(){window.location.href="${APP_PATH}/paypalProDetailExpress/mpay"}function goToUserCenter(){window.location.href="${APP_PATH}/MlfrontUser/toUserCenter"}function goToUserCenerOrder(){window.location.href="${APP_PATH}/MlfrontUser/tomyOrderPage"}function goToUserCenerCoupon(){window.location.href="${APP_PATH}/MlfrontUser/toCouponPage"}function goToUserCenerPersonal(){window.location.href="${APP_PATH}/MlfrontUser/toPersonInfoPage"}function goToSearchTrack(){window.location.href="${APP_PATH}/MlfrontOrderList/searchTrackPage"}function getPageNum(){return storage.getItem("pageNum")||1}function setPageNum(val){storage.setItem("pageNum",val)}function makerArray(n){for(var arr=[],i=0;i<n;i++)arr.push(i+1);return arr}function renderTablePagination(data){if(data){$("#table-pagination").empty();var pageUl=$('<ul class="pagination" />'),firstPageLi=$('<li class="page-item" />').append($('<a class="page-link" />').append("first")),prePageLi=$('<li class="page-item" />').append($('<a class="page-link" />').append("&laquo;")),nextPageLi=$('<li class="page-item" />').append($('<a class="page-link" />').append("&raquo;")),lastPageLi=$('<li class="page-item" />').append($('<a class="page-link" />').append("last")),pageCurrentNum=data.pageNum,pageNums=data.pages,pageArr=[],navEle;prePageLi.on("click",(function(){pageCurrentNum>1&&setPageNum(pageCurrentNum-1)})),nextPageLi.on("click",(function(){pageCurrentNum<pageNums&&setPageNum(pageCurrentNum+1)})),pageArr=pageNums>5?pageCurrentNum<=5?[1,2,3,4,5]:pageCurrentNum>pageNums-5?[pageNums-4,pageNums-3,pageNums-2,pageNums-1,pageNums]:[pageCurrentNum-2,pageCurrentNum-1,pageCurrentNum,pageCurrentNum+1,pageCurrentNum+2]:makerArray(pageNums||1),0==data.hasPreviousPage?(firstPageLi.addClass("disabled"),prePageLi.addClass("disabled")):(firstPageLi.click((function(){setPageNum(1)})),prePageLi.click((function(){setPageNum(pageCurrentNum-1)}))),0==data.hasNextPage?(nextPageLi.addClass("disabled"),lastPageLi.addClass("disabled")):(nextPageLi.click((function(){setPageNum(pageCurrentNum+1)})),lastPageLi.click((function(){setPageNum(pageNums)}))),pageUl.append(firstPageLi).append(prePageLi),$.each(pageArr,(function(i,item){var numLi=$('<li class="page-item" />').append($('<a class="page-link" href="javascript:;" />').append(item));pageCurrentNum==item&&numLi.addClass("active"),numLi.click((function(){setPageNum(item)})),pageUl.append(numLi)})),pageUl.append(nextPageLi).append(lastPageLi),$('<nav aria-label="Page navigation" />').append(pageUl).appendTo("#table-pagination")}}function getProductSlideArea(callback){$.ajax({url:"${APP_PATH}/MlbackSlides/getMlbackSlidewapListByArea",data:JSON.stringify({slideArea:3}),type:"post",dataType:"json",contentType:"application/json",success:function(data){100==data.code&&callback&&callback(data.extend.mlbackProductResList)}})}function generateSwiperSlideProduct(data){var htmlStr="",$productSwiper=$('<div class="swiper-container"><div class="swiper-wrapper"></div><div class="swiper-btn swiper-button-next"></div><div class="swiper-btn swiper-button-prev"></div></div>');return data.forEach((function(item,idx){var productLink=item.productSeo?"${APP_PATH}/"+item.productSeo+".html":"javascript:;";htmlStr+='<div class="swiper-slide product-item" data-productid="'+item.productId+'"><span class="product-discount-label'+(item.productDiscoutimgShow?" show":"")+'" style="background-image: url('+(item.productDiscoutimgurl||"")+');"></span><div class="product-img"><a href="'+productLink+'" class="lazyload" data-src="'+item.productMainimgurl+'"></a></div><div class="product-desc"><div class="product-name"><a href="'+productLink+'">'+item.productName+'</a></div><div class="product-data"><span class="product-pay-num">'+(item.productHavesalenum||0)+' Order(s)</span><span class="product-review-num">'+(item.productReviewnum||0)+' Review(s)</span></div><div class="product-price"><span class="product-define-price">$'+(item.productOriginalprice||0).toFixed(2)+'</span><span class="product-now-price">$'+(item.productOriginalprice&&item.productActoffoff?accuracyCal(item.productOriginalprice,item.productActoffoff):0)+"</span></div></div></div>"})),$productSwiper.find(".swiper-wrapper").html(htmlStr),$productSwiper}function renderIntroduceProductSlide($el,data){var productSlide=generateSwiperSlideProduct(data).addClass("introduce-product");$el.append('<div class="introduce-product-title">YOU MIGHT ALSO LIKE<div>'),$el.append(productSlide);var productSwiper=new Swiper(".introduce-product.swiper-container",{slidesPerView:"auto",spaceBetween:5,freeMode:!0,autoplay:{delay:5e3,stopOnLastSlide:!1,disableOnInteraction:!1},navigation:{nextEl:".introduce-product .swiper-button-next",prevEl:".introduce-product .swiper-button-prev"},pagination:{el:".introduce-product .swiper-pagination",clickable:!0},on:{resize:function(){productSwiper.slidesPerView=window.innerWidth>799?4:2,productSwiper.updateSlidesOffset()}}})}function accuracyCal(origin,dis){var priceArr=(origin*dis/100).toString().split("."),acurPrice=priceArr[1],newFixedPrice="00";if(acurPrice){var strFixedPrice=acurPrice.slice(0,2),fixedPrice=parseInt(1==strFixedPrice.length?strFixedPrice+"0":strFixedPrice,10),ap;newFixedPrice=(fixedPrice=parseInt(acurPrice.slice(2,3),10)>4?fixedPrice+1:fixedPrice)>9?fixedPrice:"0"+fixedPrice}return priceArr[0]+"."+newFixedPrice}$(document.body).on("click",".radio",(function(e){var $this=$(this);$this.hasClass("disabled")||(handleNormalClick($this),updateProductStatus(getSelectedItem()),showResult()),$(".radio").each((function(){mapSet[$(this).data("text")]||$(this).hasClass("active")||$(this).addClass("disabled")}))}));</script>